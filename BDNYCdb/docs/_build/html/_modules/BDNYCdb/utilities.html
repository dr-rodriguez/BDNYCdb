<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>BDNYCdb.utilities &mdash; BDNYCdb 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="BDNYCdb 0.1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for BDNYCdb.utilities</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>
<span class="c"># Utilities</span>
<span class="kn">import</span> <span class="nn">warnings</span><span class="o">,</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">xlrd</span><span class="o">,</span> <span class="nn">cPickle</span><span class="o">,</span> <span class="nn">itertools</span><span class="o">,</span> <span class="nn">astropy.units</span> <span class="kn">as</span> <span class="nn">q</span><span class="o">,</span> <span class="nn">astropy.constants</span> <span class="kn">as</span> <span class="nn">ac</span><span class="o">,</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span><span class="o">,</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span><span class="o">,</span> <span class="nn">astropy.coordinates</span> <span class="kn">as</span> <span class="nn">apc</span><span class="o">,</span> <span class="nn">scipy.stats</span> <span class="kn">as</span> <span class="nn">st</span><span class="o">,</span> <span class="nn">astropy.io.fits</span> <span class="kn">as</span> <span class="nn">pf</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span> <span class="nn">heapq</span> <span class="kn">import</span> <span class="n">nsmallest</span><span class="p">,</span> <span class="n">nlargest</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">Rbf</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="s">&#39;/Users/Joe/Documents/Python/&#39;</span>

<div class="viewcode-block" id="blackbody"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.blackbody">[docs]</a><span class="k">def</span> <span class="nf">blackbody</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Flam</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">emitted</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Given a wavelength array [um] and temperature [K], returns an array of Planck function values in [erg s-1 cm-2 A-1]</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">lam</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">lam</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="p">),</span> <span class="n">T</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">K</span>
  <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ac</span><span class="o">.</span><span class="n">h</span><span class="o">*</span><span class="n">ac</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">lam</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span> <span class="k">if</span> <span class="n">Flam</span> <span class="k">else</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">ac</span><span class="o">.</span><span class="n">h</span><span class="o">*</span><span class="n">ac</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="n">lam</span><span class="o">*</span><span class="n">ac</span><span class="o">.</span><span class="n">k_B</span><span class="o">*</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">decompose</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">Flam</span> <span class="k">else</span> <span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">I</span> <span class="k">if</span> <span class="n">emitted</span> <span class="k">else</span> <span class="n">I</span><span class="o">*</span><span class="p">((</span><span class="n">ac</span><span class="o">.</span><span class="n">R_jup</span><span class="o">*</span><span class="n">radius</span><span class="o">/</span><span class="p">(</span><span class="n">dist</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">pc</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="contour_plot"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.contour_plot">[docs]</a><span class="k">def</span> <span class="nf">contour_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">best</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">):</span>
  <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">500</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="mi">25</span><span class="p">))</span>
  <span class="n">rbf</span> <span class="o">=</span> <span class="n">Rbf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">)</span>
  <span class="n">zi</span> <span class="o">=</span> <span class="n">rbf</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(),</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Teff&#39;</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;log(g)&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">best</span><span class="p">:</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">zi</span><span class="p">)),</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">xi</span><span class="p">)),</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">yi</span><span class="p">))]))[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Teff = {}, log(g) = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">)),</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;white&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="deg2sxg"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.deg2sxg">[docs]</a><span class="k">def</span> <span class="nf">deg2sxg</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
  <span class="n">RA</span><span class="p">,</span> <span class="n">DEC</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
  <span class="k">if</span> <span class="n">ra</span><span class="p">:</span>
    <span class="n">ra</span> <span class="o">/=</span> <span class="mf">15.</span>
    <span class="n">RA</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;{:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">))))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">apc</span><span class="o">.</span><span class="n">angles</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="n">apc</span><span class="o">.</span><span class="n">angles</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="s">&#39;degree&#39;</span><span class="p">)))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">RA</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">RA</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">RA</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="n">RA</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RA</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="n">dec</span><span class="p">:</span> 
    <span class="n">DEC</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;{:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">))))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">apc</span><span class="o">.</span><span class="n">angles</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="s">&#39;degree&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DEC</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">DEC</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">DEC</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">n</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> <span class="n">DEC</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEC</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.0&#39;</span>
    <span class="n">DEC</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DEC</span><span class="p">)</span>
    <span class="n">DEC</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;-&#39;</span> <span class="k">if</span> <span class="n">dec</span><span class="o">&lt;</span><span class="mi">0</span> <span class="k">else</span> <span class="s">&#39;+&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">DEC</span>
    
  <span class="k">return</span> <span class="p">(</span><span class="n">RA</span><span class="p">,</span> <span class="n">DEC</span><span class="p">)</span> <span class="k">if</span> <span class="n">ra</span> <span class="ow">and</span> <span class="n">dec</span> <span class="k">else</span> <span class="n">RA</span> <span class="ow">or</span> <span class="n">DEC</span> 
  </div>
<div class="viewcode-block" id="dict2txt"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.dict2txt">[docs]</a><span class="k">def</span> <span class="nf">dict2txt</span><span class="p">(</span><span class="n">DICT</span><span class="p">,</span> <span class="n">writefile</span><span class="p">,</span> <span class="n">column1</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">colsort</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">row2</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">preamble</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">postamble</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">empties</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">all_str</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">literal</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">blanks</span><span class="o">=</span><span class="s">r&#39;</span><span class="se">\\</span><span class="s">nodata&#39;</span><span class="p">,</span> <span class="n">LaTeX</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Given a nested dictionary *DICT*, writes a .txt file with keys as columns. </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">import</span> <span class="nn">csv</span>
  <span class="n">D</span> <span class="o">=</span> <span class="n">DICT</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">order</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">D</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">writefile</span><span class="p">,</span> <span class="s">&#39;ab&#39;</span> <span class="k">if</span> <span class="n">append</span> <span class="k">else</span> <span class="s">&#39;w&#39;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">writer</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delim</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONE</span><span class="p">,</span> <span class="n">escapechar</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">),</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">preamble</span><span class="p">:</span> <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">preamble</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">D</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">literal</span><span class="p">:</span>
          <span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">blanks</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">else</span> <span class="nb">repr</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="s">&#39;unit&#39;</span><span class="p">):</span> <span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
          <span class="k">if</span> <span class="n">digits</span><span class="p">:</span> <span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">else</span> <span class="s">&#39;{:.{}f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">digits</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">],(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">all_str</span> <span class="k">else</span> <span class="s">&#39;{:.{}f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span><span class="n">digits</span><span class="p">)</span> <span class="k">if</span> <span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">all_str</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
          <span class="k">else</span><span class="p">:</span> <span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">else</span> <span class="s">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">],(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="k">else</span> <span class="s">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span> <span class="k">if</span> <span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">all_str</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">w</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
    <span class="n">head</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;{!s:{}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column1</span><span class="p">,</span><span class="n">width</span><span class="p">)]</span>
    <span class="n">headorder</span> <span class="o">=</span> <span class="n">order</span> <span class="ow">or</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">D</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">headorder</span><span class="p">:</span> <span class="n">head</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;{!s:{}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">width</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">row2</span><span class="p">:</span> <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;{!s:{}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">row2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">delim</span> <span class="o">==</span> <span class="s">&#39;,&#39;</span><span class="p">:</span> <span class="n">head</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">head</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">LaTeX</span><span class="p">:</span> 
      <span class="n">head</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">r&#39;\tablehead{&#39;</span><span class="o">+</span><span class="n">head</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">row2</span><span class="p">:</span> <span class="n">units</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">r&#39;}\startdata&#39;</span>
      <span class="k">else</span><span class="p">:</span> <span class="n">head</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">head</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">r&#39;}\startdata&#39;</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">row2</span><span class="p">:</span> 
      <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
    
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">D</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">colsort</span><span class="p">])</span> <span class="k">if</span> <span class="n">colsort</span> <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
      <span class="n">order</span> <span class="o">=</span> <span class="n">order</span> <span class="ow">or</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
      <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;{!s:{}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">width</span><span class="p">)]</span>
      <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="n">delim</span><span class="o">==</span><span class="s">&#39;,&#39;</span> <span class="k">else</span> <span class="s">&#39;-&#39;</span>
        <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">r&#39;{!s:{}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">],</span><span class="n">width</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">delim</span> <span class="o">==</span> <span class="s">&#39;,&#39;</span><span class="p">:</span> <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">LaTeX</span> <span class="ow">and</span> <span class="n">n</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s">r&#39;</span><span class="se">\\</span><span class="s">&#39;</span>
      <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s">r&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">row</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">LaTeX</span><span class="p">:</span> <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s">r&#39;\enddata&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">postamble</span><span class="p">:</span> <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">postamble</span><span class="p">])</span>
      </div>
<div class="viewcode-block" id="distance"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.distance">[docs]</a><span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">coord1</span><span class="p">,</span> <span class="n">coord2</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Given n-dimensional coordinates of two points, returns the distance between them</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coord1</span><span class="p">,</span><span class="n">coord2</span><span class="p">)]))</span>
</div>
<div class="viewcode-block" id="filter_info"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.filter_info">[docs]</a><span class="k">def</span> <span class="nf">filter_info</span><span class="p">(</span><span class="n">band</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  (By Joe Filippazzo)</span>
<span class="sd">   </span>
<span class="sd">  Effective, min, and max wavelengths in [um] and zeropoint in [erg s-1 cm-2 A-1] and [photon s-1 cm-2 A-1] for SDSS, Bessel, 2MASS, IRAC and WISE filters IN THE VEGA SYSTEM. Values from SVO filter profile service.</span>
<span class="sd">  </span>
<span class="sd">  *band*</span>
<span class="sd">      Name of filter band (e.g. &#39;J&#39; from 2MASS, &#39;W1&#39; from WISE, etc.) or list of filter systems (e.g. [&#39;SDSS&#39;,&#39;2MASS&#39;,&#39;WISE&#39;])</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">Filters</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;FUV&quot;</span><span class="p">:</span>     <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.154226</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.134032</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.180643</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">6.486734e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">5.035932e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">2.62</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;GALEX&#39;</span> <span class="p">},</span>
              <span class="s">&quot;NUV&quot;</span><span class="p">:</span>     <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.227437</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.169252</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.300667</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">4.511628e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">5.165788e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">2.94</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;GALEX&#39;</span> <span class="p">},</span>

              <span class="s">&quot;U&quot;</span><span class="p">:</span>       <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.357065</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.303125</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.417368</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">3.656264e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">6.576522e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mf">0.0915</span><span class="p">,</span> <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">1.56</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;Bessel&#39;</span> <span class="p">},</span> 
              <span class="s">&quot;B&quot;</span><span class="p">:</span>       <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.437812</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.363333</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.549706</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">6.286883e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.385995e+03</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mf">0.0069</span><span class="p">,</span> <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">1.31</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;Bessel&#39;</span> <span class="p">},</span> 
              <span class="s">&quot;V&quot;</span><span class="p">:</span>       <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.544579</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.473333</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.687500</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">3.571744e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">9.837109e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">1.02</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;Bessel&#39;</span> <span class="p">},</span>
              <span class="s">&quot;R&quot;</span><span class="p">:</span>       <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.641420</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.550435</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.883333</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">2.157178e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">6.971704e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mf">0.0018</span><span class="p">,</span> <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.83</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;Bessel&#39;</span> <span class="p">},</span>
              <span class="s">&quot;I&quot;</span><span class="p">:</span>       <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.797880</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.704167</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.916667</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">1.132454e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">4.549636e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.0014</span><span class="p">,</span><span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.61</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;Bessel&#39;</span> <span class="p">},</span>

              <span class="s">&quot;u&quot;</span><span class="p">:</span>       <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.3543</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.304828</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.402823</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">3.617963e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">6.546739e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mf">0.91</span><span class="p">,</span>   <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">1.58</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;SDSS&#39;</span> <span class="p">},</span>  <span class="c"># AB to Vega transformations from Blanton et al. (2007)</span>
              <span class="s">&quot;g&quot;</span><span class="p">:</span>       <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.4770</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.378254</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.554926</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">5.491077e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.282871e+03</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.08</span><span class="p">,</span>  <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">1.23</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;SDSS&#39;</span> <span class="p">},</span>  <span class="c"># AB to Vega transformations from Blanton et al. (2007)</span>
              <span class="s">&quot;r&quot;</span><span class="p">:</span>       <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.6231</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.541534</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.698914</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">2.528924e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">7.794385e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mf">0.16</span><span class="p">,</span>   <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.89</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;SDSS&#39;</span> <span class="p">},</span>  <span class="c"># AB to Vega transformations from Blanton et al. (2007)</span>
              <span class="s">&quot;i&quot;</span><span class="p">:</span>       <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.7625</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.668947</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.838945</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">1.409436e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">5.278550e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mf">0.37</span><span class="p">,</span>   <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.68</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;SDSS&#39;</span> <span class="p">},</span>  <span class="c"># AB to Vega transformations from Blanton et al. (2007)</span>
              <span class="s">&quot;z&quot;</span><span class="p">:</span>       <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.9134</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.796044</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.083325</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">8.501067e-10</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">3.807540e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mf">0.54</span><span class="p">,</span>   <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.52</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;SDSS&#39;</span> <span class="p">},</span>  <span class="c"># AB to Vega transformations from Blanton et al. (2007)</span>
              
              <span class="s">&quot;DES_u&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.3543</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.304828</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.402823</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">5.360165e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.038526e+03</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>   <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;DES&#39;</span> <span class="p">},</span>
              <span class="s">&quot;DES_g&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.4770</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.378254</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.554926</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">5.215897e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.243521e+03</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>   <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;DES&#39;</span> <span class="p">},</span>
              <span class="s">&quot;DES_r&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.6231</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.541534</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.698914</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">2.265389e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">7.234969e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>   <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;DES&#39;</span> <span class="p">},</span>
              <span class="s">&quot;DES_i&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.7625</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.668947</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.838945</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">1.235064e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">4.820083e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>   <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;DES&#39;</span> <span class="p">},</span>
              <span class="s">&quot;DES_z&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.9134</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.796044</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.083325</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">8.072777e-10</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">3.712548e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>   <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;DES&#39;</span> <span class="p">},</span>
              <span class="s">&quot;DES_Y&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">1.0289</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.930000</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.074600</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">6.596909e-10</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">3.280450e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>   <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;DES&#39;</span> <span class="p">},</span>
              
              <span class="s">&quot;J&quot;</span><span class="p">:</span>       <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">1.2350</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1.080647</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.406797</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">3.129e-10</span><span class="p">,</span>    <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.943482e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.0166</span><span class="p">,</span> <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;2MASS&#39;</span> <span class="p">},</span> <span class="c"># ZP from Cohen et al. (2003)</span>
              <span class="s">&quot;H&quot;</span><span class="p">:</span>       <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">1.6620</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1.478738</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.823102</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">1.133e-10</span><span class="p">,</span>    <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">9.437966e+01</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.0146</span><span class="p">,</span> <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;2MASS&#39;</span> <span class="p">},</span> <span class="c"># ZP from Cohen et al. (2003)</span>
              <span class="s">&quot;Ks&quot;</span><span class="p">:</span>      <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">2.1590</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1.954369</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">2.355240</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">4.283e-11</span><span class="p">,</span>    <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">4.664740e+01</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.0710</span><span class="p">,</span> <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;2MASS&#39;</span> <span class="p">},</span> <span class="c"># ZP from Cohen et al. (2003)</span>

              <span class="s">&quot;MKO_Y&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">1.02894</span><span class="p">,</span>  <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.9635</span><span class="p">,</span>   <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.1025</span><span class="p">,</span>   <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">5.869238e-10</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">3.033632e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;MKO&#39;</span> <span class="p">},</span>
              <span class="s">&quot;MKO_J&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">1.250</span><span class="p">,</span>    <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1.148995</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.348332</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">3.01e-10</span><span class="p">,</span>     <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.899569e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;MKO&#39;</span> <span class="p">},</span>   <span class="c"># eff and ZP from Tokunaga &amp; Vacca (2005)</span>
              <span class="s">&quot;MKO_H&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">1.644</span><span class="p">,</span>    <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1.450318</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.808855</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">1.18e-10</span><span class="p">,</span>     <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">9.761983e+01</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;MKO&#39;</span> <span class="p">},</span>   <span class="c"># eff and ZP from Tokunaga &amp; Vacca (2005)</span>
              <span class="s">&quot;MKO_K&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">2.198</span><span class="p">,</span>    <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1.986393</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">2.397097</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">4.00e-11</span><span class="p">,</span>     <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">4.488476e+01</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.12</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;MKO&#39;</span> <span class="p">},</span>   <span class="c"># eff and ZP from Tokunaga &amp; Vacca (2005)</span>
              <span class="s">&quot;MKO_L&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">3.754</span><span class="p">,</span>    <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">3.326622</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">4.207764</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">5.31e-12</span><span class="p">,</span>     <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.016455e+01</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.06</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;MKO&#39;</span> <span class="p">},</span>   <span class="c"># eff and ZP from Tokunaga &amp; Vacca (2005)</span>
              <span class="s">&quot;MKO_M&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">4.702</span><span class="p">,</span>    <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">4.496502</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">4.865044</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">2.22e-12</span><span class="p">,</span>     <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">5.305197e+00</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;MKO&#39;</span> <span class="p">},</span>   <span class="c"># eff and ZP from Tokunaga &amp; Vacca (2005)</span>

              <span class="s">&quot;DENIS_I&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.78621</span><span class="p">,</span>  <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.7007</span><span class="p">,</span>   <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.9140</span><span class="p">,</span>   <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">1.182102e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">4.681495e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.63</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;DENIS&#39;</span> <span class="p">},</span>
              <span class="s">&quot;DENIS_J&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">1.22106</span><span class="p">,</span>  <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1.0508</span><span class="p">,</span>   <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.3980</span><span class="p">,</span>   <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">3.190256e-10</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.961698e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.31</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;DENIS&#39;</span> <span class="p">},</span>
              <span class="s">&quot;DENIS_Ks&quot;</span><span class="p">:{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">2.14650</span><span class="p">,</span>  <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1.9474</span><span class="p">,</span>   <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">2.3979</span><span class="p">,</span>   <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">4.341393e-11</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">4.691482e+01</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.13</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;DENIS&#39;</span> <span class="p">},</span>              

              <span class="s">&quot;W1&quot;</span><span class="p">:</span>      <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">3.3526</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">2.754097</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">3.872388</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">8.1787e-12</span><span class="p">,</span>   <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.375073e+01</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.07</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;WISE&#39;</span> <span class="p">},</span> <span class="c"># eff and ZP from Jarrett et al. (2011)</span>
              <span class="s">&quot;W2&quot;</span><span class="p">:</span>      <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">4.6028</span><span class="p">,</span>   <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">3.963326</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">5.341360</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">2.4150e-12</span><span class="p">,</span>   <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">5.586982e+00</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;WISE&#39;</span> <span class="p">},</span> <span class="c"># eff and ZP from Jarrett et al. (2011)</span>
              <span class="s">&quot;W3&quot;</span><span class="p">:</span>      <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">11.5608</span><span class="p">,</span>  <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">7.443044</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">17.26134</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">6.5151e-14</span><span class="p">,</span>   <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">3.567555e-01</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.06</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;WISE&#39;</span> <span class="p">},</span> <span class="c"># eff and ZP from Jarrett et al. (2011)</span>
              <span class="s">&quot;W4&quot;</span><span class="p">:</span>      <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">22.0883</span><span class="p">,</span>  <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">19.52008</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">27.91072</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">5.0901e-15</span><span class="p">,</span>   <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">5.510352e-02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;WISE&#39;</span> <span class="p">},</span> <span class="c"># eff and ZP from Jarrett et al. (2011)</span>

              <span class="s">&quot;[3.6]&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">3.507511</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">3.129624</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">3.961436</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">6.755364e-12</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.192810e+01</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.07</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;IRAC&#39;</span> <span class="p">},</span>
              <span class="s">&quot;[4.5]&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">4.436578</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">3.917328</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">5.056057</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">2.726866e-12</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">6.090264e+00</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;IRAC&#39;</span> <span class="p">},</span>
              <span class="s">&quot;[5.8]&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">5.628102</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">4.898277</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">6.508894</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">1.077512e-12</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">3.052866e+00</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.04</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;IRAC&#39;</span> <span class="p">},</span>
              <span class="s">&quot;[8]&quot;</span><span class="p">:</span>     <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">7.589159</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">6.299378</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">9.587595</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">3.227052e-13</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.232887e+00</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.03</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;IRAC&#39;</span> <span class="p">},</span>              
              <span class="s">&quot;[24]&quot;</span><span class="p">:</span>    <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">23.20960</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">19.88899</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">30.93838</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">3.935507e-15</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">4.598249e-02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;MIPS&#39;</span> <span class="p">},</span>

              <span class="s">&quot;G&quot;</span><span class="p">:</span>       <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.60</span><span class="p">,</span>     <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.321</span><span class="p">,</span>    <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.103</span><span class="p">,</span>    <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">2.862966e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">8.053711e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;GAIA&#39;</span><span class="p">},</span>
              <span class="s">&quot;BP&quot;</span><span class="p">:</span>      <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.55</span><span class="p">,</span>     <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.321</span><span class="p">,</span>    <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.680</span><span class="p">,</span>    <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">4.298062e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.067265e+03</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;GAIA&#39;</span><span class="p">},</span>
              <span class="s">&quot;RP&quot;</span><span class="p">:</span>      <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">,</span>     <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.627</span><span class="p">,</span>    <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.103</span><span class="p">,</span>    <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">1.294828e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">4.948727e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;GAIA&#39;</span><span class="p">},</span>

              <span class="s">&quot;F090M&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.897360</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.784317</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.013298</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">8.395228e-10</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">3.792477e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.51</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F110W&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">1.059175</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.782629</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.432821</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">4.726040e-10</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">2.519911e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.39</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F140W&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">1.364531</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1.185379</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.612909</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">2.133088e-10</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.465263e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.26</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F164N&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">1.646180</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1.629711</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.663056</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">1.109648e-10</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">9.195720e+01</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.19</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F170M&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">1.699943</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1.579941</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.837134</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">1.015711e-10</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">8.692163e+01</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.18</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F190N&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">1.898486</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1.880845</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.917673</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">6.957714e-11</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">6.649628e+01</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F215N&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">2.148530</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">2.128579</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">2.168078</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">4.355167e-11</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">4.710529e+01</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.13</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F336W&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.332930</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.295648</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.379031</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">3.251259e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">5.486427e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">1.70</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F390N&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.388799</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.384000</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.393600</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">5.673647e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.143901e+03</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">1.48</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F475W&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.470819</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.386334</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.556272</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">5.331041e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.260475e+03</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">1.21</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F555W&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.533091</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.458402</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.620850</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">4.062007e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">1.061011e+03</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">1.05</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F625W&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.626619</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.544589</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.709961</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">2.478260e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">7.679998e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.68</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F656N&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.656368</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.653838</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.658740</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">1.434529e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">4.737886e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.81</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F673N&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.673224</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.667780</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.678367</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">1.908442e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">6.499706e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.78</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F775W&quot;</span><span class="p">:</span>   <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.765263</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.680365</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.863185</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">1.323662e-09</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">5.055354e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.65</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">},</span>
              <span class="s">&quot;F850LP&quot;</span><span class="p">:</span>  <span class="p">{</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span> <span class="mf">0.963736</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.832000</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.100000</span><span class="p">,</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span> <span class="mf">8.069014e-10</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span> <span class="mf">3.706372e+02</span><span class="p">,</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>      <span class="s">&#39;ext&#39;</span><span class="p">:</span> <span class="mf">0.46</span><span class="p">,</span>   <span class="s">&#39;system&#39;</span><span class="p">:</span> <span class="s">&#39;HST&#39;</span> <span class="p">}}</span>    
  
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">band</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Filters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
      <span class="k">if</span> <span class="n">Filters</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;system&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span> <span class="n">Filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Filters</span>
  <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">band</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Filters</span><span class="p">[</span><span class="n">band</span><span class="p">]</span>
 
  </div>
<div class="viewcode-block" id="find"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.find">[docs]</a><span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;                                                                               </span>
<span class="sd">  For given filename and directory tree, returns the path to the file. </span>
<span class="sd">  For only file extension given as filename, returns list of paths to all files with that extnsion in that directory tree.  </span>

<span class="sd">  *filename*</span>
<span class="sd">    Filename or file extension to search for (e.g. &#39;my_file.txt&#39; or just &#39;.txt&#39;)</span>
<span class="sd">  *tree*</span>
<span class="sd">    Directory tree base to start the walk (e.g. &#39;/Users/Joe/Documents/&#39;)</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">import</span> <span class="nn">os</span>
  <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
          <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>  
      <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>

  <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="flux_calibrate"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.flux_calibrate">[docs]</a><span class="k">def</span> <span class="nf">flux_calibrate</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">sig_m</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">sig_d</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">scale_to</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">pc</span><span class="p">):</span>
  <span class="c"># if isinstance(mag,(float,int)): return [mag-5*np.log10(dist/scale_to), np.sqrt(sig_m**2 + 25*(sig_d/(dist*np.log(10))).value**2) if sig_m and sig_d else &#39;&#39;]</span>
  <span class="c"># elif hasattr(mag,&#39;unit&#39;): return [(mag*dist**2/scale_to**2).to(mag.unit), (np.sqrt((sig_m*dist**2)**2 + (2*sig_d*mag*dist)**2)*mag.unit*dist.unit**2/scale_to**2) if sig_m!=&#39;&#39; and sig_d else &#39;&#39;]</span>
  <span class="c"># else: print &#39;Could not flux calibrate that input to distance {}.&#39;.format(dist)</span>
  
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mag</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span> <span class="k">return</span> <span class="p">[</span><span class="n">mag</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">dist</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">pc</span><span class="p">)</span><span class="o">/</span><span class="n">scale_to</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">pc</span><span class="p">))</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sig_m</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">25</span><span class="o">*</span><span class="p">(</span><span class="n">sig_d</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">pc</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">pc</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span><span class="o">.</span><span class="n">value</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">sig_m</span> <span class="ow">and</span> <span class="n">sig_d</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">]</span>
  <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="s">&#39;unit&#39;</span><span class="p">):</span> <span class="k">return</span> <span class="p">[</span><span class="n">mag</span><span class="o">*</span><span class="p">(</span><span class="n">dist</span><span class="o">/</span><span class="n">scale_to</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">sig_m</span><span class="o">*</span><span class="p">(</span><span class="n">dist</span><span class="o">/</span><span class="n">scale_to</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mag</span><span class="o">*</span><span class="p">(</span><span class="n">sig_d</span><span class="o">*</span><span class="n">dist</span><span class="o">/</span><span class="n">scale_to</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">sig_m</span><span class="o">!=</span><span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">sig_d</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;Could not flux calibrate that input to distance {}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="get_filters"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.get_filters">[docs]</a><span class="k">def</span> <span class="nf">get_filters</span><span class="p">(</span><span class="n">filter_directories</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;{}Filters/{}/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;2MASS&#39;</span><span class="p">,</span><span class="s">&#39;SDSS&#39;</span><span class="p">,</span><span class="s">&#39;WISE&#39;</span><span class="p">,</span><span class="s">&#39;IRAC&#39;</span><span class="p">,</span><span class="s">&#39;MIPS&#39;</span><span class="p">,</span><span class="s">&#39;HST&#39;</span><span class="p">,</span><span class="s">&#39;Bessel&#39;</span><span class="p">,</span><span class="s">&#39;MKO&#39;</span><span class="p">,</span><span class="s">&#39;GALEX&#39;</span><span class="p">,</span><span class="s">&#39;DENIS&#39;</span><span class="p">,</span><span class="s">&#39;GAIA&#39;</span><span class="p">,</span><span class="s">&#39;DES&#39;</span><span class="p">]],</span> <span class="n">systems</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;2MASS&#39;</span><span class="p">,</span><span class="s">&#39;SDSS&#39;</span><span class="p">,</span><span class="s">&#39;WISE&#39;</span><span class="p">,</span><span class="s">&#39;IRAC&#39;</span><span class="p">,</span><span class="s">&#39;MIPS&#39;</span><span class="p">,</span><span class="s">&#39;HST&#39;</span><span class="p">,</span><span class="s">&#39;Bessel&#39;</span><span class="p">,</span><span class="s">&#39;MKO&#39;</span><span class="p">,</span><span class="s">&#39;GALEX&#39;</span><span class="p">,</span><span class="s">&#39;DENIS&#39;</span><span class="p">,</span><span class="s">&#39;GAIA&#39;</span><span class="p">,</span><span class="s">&#39;DES&#39;</span><span class="p">]):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Grabs all the .txt spectral response curves and returns a dictionary of wavelength array [um], filter response [unitless], effective, min and max wavelengths [um], and zeropoint [erg s-1 cm-2 A-1]. </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filter_directories</span><span class="o">+</span><span class="s">&#39;*.txt&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_directories</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="s">&#39;*.txt&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filter_directories</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">k</span><span class="p">]</span>

  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;No filters in&#39;</span><span class="p">,</span> <span class="n">filter_directories</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">filter_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filepath</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">RSR_x</span><span class="p">,</span> <span class="n">RSR_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">txt2dict</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="n">to_list</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">skip</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;#&#39;</span><span class="p">]))]</span>
        <span class="n">RSR_x</span><span class="p">,</span> <span class="n">RSR_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">RSR_x</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">um</span> <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">RSR_x</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">100</span> <span class="k">else</span> <span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">um</span><span class="p">),</span> <span class="n">RSR_y</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">um</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">um</span>
        <span class="n">Filt</span> <span class="o">=</span> <span class="n">filter_info</span><span class="p">(</span><span class="n">filter_name</span><span class="p">)</span>
        <span class="n">filters</span><span class="p">[</span><span class="n">filter_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;wav&#39;</span><span class="p">:</span><span class="n">RSR_x</span><span class="p">,</span> <span class="s">&#39;rsr&#39;</span><span class="p">:</span><span class="n">RSR_y</span><span class="p">,</span> <span class="s">&#39;system&#39;</span><span class="p">:</span><span class="n">Filt</span><span class="p">[</span><span class="s">&#39;system&#39;</span><span class="p">],</span> <span class="s">&#39;eff&#39;</span><span class="p">:</span><span class="n">Filt</span><span class="p">[</span><span class="s">&#39;eff&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">:</span><span class="n">Filt</span><span class="p">[</span><span class="s">&#39;min&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span><span class="n">Filt</span><span class="p">[</span><span class="s">&#39;max&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="s">&#39;ext&#39;</span><span class="p">:</span><span class="n">Filt</span><span class="p">[</span><span class="s">&#39;ext&#39;</span><span class="p">],</span> <span class="s">&#39;toVega&#39;</span><span class="p">:</span><span class="n">Filt</span><span class="p">[</span><span class="s">&#39;toVega&#39;</span><span class="p">],</span> <span class="s">&#39;zp&#39;</span><span class="p">:</span><span class="n">Filt</span><span class="p">[</span><span class="s">&#39;zp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span> <span class="s">&#39;zp_photon&#39;</span><span class="p">:</span><span class="n">Filt</span><span class="p">[</span><span class="s">&#39;zp_photon&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">AA</span> <span class="p">}</span>
      <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">filters</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;system&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">systems</span><span class="p">:</span> <span class="n">filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>    
    <span class="k">return</span> <span class="n">filters</span>
</div>
<div class="viewcode-block" id="goodness"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.goodness">[docs]</a><span class="k">def</span> <span class="nf">goodness</span><span class="p">(</span><span class="n">spec1</span><span class="p">,</span> <span class="n">spec2</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[],</span> <span class="n">filt_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec1</span><span class="p">,</span><span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec2</span><span class="p">,</span><span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">filt_dict</span><span class="p">:</span>
    <span class="n">bands</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">bnds</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filt_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">i</span> <span class="ow">in</span> <span class="n">spec1</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">i</span> <span class="ow">in</span> <span class="n">spec2</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">eff</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">filt_dict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;eff&#39;</span><span class="p">],</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">]):</span>
      <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">spec1</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">spec1</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s">&#39;_unc&#39;</span><span class="p">],</span><span class="n">spec2</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">spec2</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s">&#39;_unc&#39;</span><span class="p">]]):</span> <span class="n">bnds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">w1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eff</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">f1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec1</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">e1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec1</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s">&#39;_unc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">f2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec2</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">e2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec2</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s">&#39;_unc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">b</span><span class="o">+</span><span class="s">&#39;_unc&#39;</span> <span class="ow">in</span> <span class="n">spec2</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span><span class="p">),</span> <span class="n">weight</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">filt_dict</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="s">&#39;max&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">filt_dict</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="s">&#39;min&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">weighting</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">bands</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="p">[</span><span class="n">bnds</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">weight</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">printer</span><span class="p">([</span><span class="s">&#39;Band&#39;</span><span class="p">,</span><span class="s">&#39;W_spec1&#39;</span><span class="p">,</span><span class="s">&#39;F_spec1&#39;</span><span class="p">,</span><span class="s">&#39;E_spec1&#39;</span><span class="p">,</span><span class="s">&#39;F_spec2&#39;</span><span class="p">,</span><span class="s">&#39;E_spec2&#39;</span><span class="p">,</span><span class="s">&#39;Weight&#39;</span><span class="p">,</span><span class="s">&#39;g-factor&#39;</span><span class="p">],</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">bnds</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">weight</span><span class="o">*</span><span class="p">(</span><span class="n">f1</span><span class="o">-</span><span class="n">f2</span><span class="o">*</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">weight</span><span class="o">*</span><span class="n">f1</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="p">(</span><span class="n">e1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">e2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">weight</span><span class="o">*</span><span class="n">f2</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">e1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">e2</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">e1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">e2</span><span class="o">**</span><span class="mi">2</span><span class="p">)]))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">spec1</span><span class="p">,</span> <span class="n">spec2</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;unit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">spec1</span><span class="p">,</span><span class="n">spec2</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">spec1</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">idx_exclude</span><span class="p">(</span><span class="n">spec1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">exclude</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spec1</span><span class="p">]</span>
    <span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">e1</span><span class="p">),</span> <span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">e2</span><span class="p">),</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">spec1</span><span class="p">,</span> <span class="n">rebin_spec</span><span class="p">(</span><span class="n">spec2</span><span class="p">,</span> <span class="n">spec1</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">spec1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">weight</span><span class="p">[</span><span class="n">weight</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">weight</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">C</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weight</span><span class="o">*</span><span class="n">f1</span><span class="o">*</span><span class="n">f2</span><span class="o">/</span><span class="p">(</span><span class="n">e1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">e2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">weight</span><span class="o">*</span><span class="n">f2</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">e1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">e2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
  <span class="n">G</span> <span class="o">=</span> <span class="n">weight</span><span class="o">*</span><span class="p">(</span><span class="n">f1</span><span class="o">-</span><span class="n">f2</span><span class="o">*</span><span class="n">C</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">e1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">e2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(),</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;spec1&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">f2</span><span class="o">*</span><span class="n">C</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;spec2 binned&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">G</span> <span class="k">if</span> <span class="n">array</span> <span class="k">else</span> <span class="nb">sum</span><span class="p">(</span><span class="n">G</span><span class="p">),</span> <span class="n">C</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="group"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.group">[docs]</a><span class="k">def</span> <span class="nf">group</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">),</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span> <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="idx_include"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.idx_include">[docs]</a><span class="k">def</span> <span class="nf">idx_include</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">include</span><span class="p">):</span>
  <span class="c"># if hasattr(x,&#39;unit&#39;): x = x.value</span>
  <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span><span class="nb">map</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="o">&lt;</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">include</span><span class="p">])))))[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span><span class="nb">map</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="o">&lt;</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">include</span><span class="p">]])))))[</span><span class="mi">0</span><span class="p">]</span> 
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="idx_exclude"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.idx_exclude">[docs]</a><span class="k">def</span> <span class="nf">idx_exclude</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">exclude</span><span class="p">):</span>
  <span class="c"># if hasattr(x,&#39;unit&#39;): x = x.value</span>
  <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span><span class="nb">map</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="o">&lt;</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">])))))[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> 
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span><span class="nb">map</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="o">&lt;</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">])))))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="inject_average"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.inject_average">[docs]</a><span class="k">def</span> <span class="nf">inject_average</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Used to smooth edges after trimming a spectrum. Injects a new data point into a *spectrum* at given *position* with flux value equal to the average of the *n* elements in the given *direction*.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">units</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">unit</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;unit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spectrum</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;unit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spectrum</span><span class="p">],</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;unit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spectrum</span><span class="p">])</span>
  <span class="n">new_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">position</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">spectrum</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>
  <span class="n">rows</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="n">rows</span><span class="p">)</span><span class="o">+</span><span class="p">[</span><span class="n">new_pos</span><span class="p">])</span>
  <span class="n">sample</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">rows</span><span class="p">[</span><span class="n">rows</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">new_pos</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">n</span> <span class="k">if</span> <span class="n">direction</span><span class="o">==</span><span class="s">&#39;left&#39;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="n">rows</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">new_pos</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">n</span> <span class="k">if</span> <span class="n">direction</span><span class="o">==</span><span class="s">&#39;right&#39;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)])]</span>
  <span class="n">final_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">position</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">sample</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)]</span>
  <span class="n">rows</span><span class="p">[</span><span class="n">rows</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">new_pos</span><span class="p">)]</span> <span class="o">=</span> <span class="n">final_pos</span>
  <span class="n">spectrum</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">rows</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">units</span><span class="p">,</span><span class="n">spectrum</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="Jy2mag"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.Jy2mag">[docs]</a><span class="k">def</span> <span class="nf">Jy2mag</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">jy</span><span class="p">,</span> <span class="n">jy_unc</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">return</span> <span class="n">flux2mag</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="n">jy</span><span class="o">/</span><span class="n">filter_dict</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="s">&#39;eff&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="p">),</span> <span class="n">sig_f</span><span class="o">=</span><span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="n">jy_unc</span><span class="o">/</span><span class="n">filter_dict</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="s">&#39;eff&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="p">),</span> <span class="n">photon</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="mag2flux"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.mag2flux">[docs]</a><span class="k">def</span> <span class="nf">mag2flux</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">sig_m</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">photon</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  For given band and magnitude returns the flux value (and uncertainty if *sig_m*) in [ergs][s-1][cm-2][A-1]</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">filt</span> <span class="o">=</span> <span class="n">filter_dict</span><span class="p">[</span><span class="n">band</span><span class="p">]</span>
  <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">filt</span><span class="p">[</span><span class="s">&#39;zp_photon&#39;</span> <span class="k">if</span> <span class="n">photon</span> <span class="k">else</span> <span class="s">&#39;zp&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">mag</span><span class="o">/</span><span class="mf">2.5</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">((</span><span class="mi">1</span> <span class="k">if</span> <span class="n">photon</span> <span class="k">else</span> <span class="n">q</span><span class="o">.</span><span class="n">erg</span><span class="p">)</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="p">)</span>
  <span class="n">sig_f</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">sig_m</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span> <span class="k">if</span> <span class="n">sig_m</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">sig_f</span><span class="p">]</span>
  </div>
<div class="viewcode-block" id="flux2mag"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.flux2mag">[docs]</a><span class="k">def</span> <span class="nf">flux2mag</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sig_f</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">photon</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> 
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  For given band and flux returns the magnitude value (and uncertainty if *sig_f*)</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">filt</span> <span class="o">=</span> <span class="n">filter_dict</span><span class="p">[</span><span class="n">band</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">unit</span><span class="o">==</span><span class="s">&#39;Jy&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span> <span class="n">sig_f</span> <span class="o">=</span> <span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="n">f</span><span class="o">/</span><span class="n">filt</span><span class="p">[</span><span class="s">&#39;eff&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="p">),</span> <span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="n">sig_f</span><span class="o">/</span><span class="n">filt</span><span class="p">[</span><span class="s">&#39;eff&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">photon</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span> <span class="n">sig_f</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">filt</span><span class="p">[</span><span class="s">&#39;eff&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">h</span><span class="o">*</span><span class="n">ac</span><span class="o">.</span><span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">erg</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="p">),</span> <span class="p">(</span><span class="n">sig_f</span><span class="o">*</span><span class="p">(</span><span class="n">filt</span><span class="p">[</span><span class="s">&#39;eff&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">h</span><span class="o">*</span><span class="n">ac</span><span class="o">.</span><span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">erg</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="p">)</span>
  <span class="n">m</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">f</span><span class="o">/</span><span class="n">filt</span><span class="p">[</span><span class="s">&#39;zp_photon&#39;</span> <span class="k">if</span> <span class="n">photon</span> <span class="k">else</span> <span class="s">&#39;zp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
  <span class="n">sig_m</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.5</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">sig_f</span><span class="o">/</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">sig_f</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>  
  <span class="k">return</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">sig_m</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="manual_legend"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.manual_legend">[docs]</a><span class="k">def</span> <span class="nf">manual_legend</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">markers</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">sizes</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">styles</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">overplot</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figlegend</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Add manually created legends to plots and subplots</span>
<span class="sd">  *labels*</span>
<span class="sd">    A list of strings to appear as legend text, e.g. [&#39;Foo&#39;,&#39;Bar&#39;,&#39;Baz&#39;]</span>
<span class="sd">  *colors*</span>
<span class="sd">    A list of colors for the legend markers, e.g. [&#39;r&#39;,&#39;g&#39;,&#39;b&#39;]</span>
<span class="sd">  *markers*</span>
<span class="sd">    A list of markers or linestyles to use in the legend, e.g. [&#39;o&#39;,&#39;^&#39;,&#39;--&#39;]</span>
<span class="sd">  *edges*</span>
<span class="sd">    A list of colors to use as marker edge colors, e.g. [&#39;m&#39;,&#39;None&#39;,&#39;k&#39;]</span>
<span class="sd">  *sizes*</span>
<span class="sd">    A list of integers to specify the marker size of points or the linewidth of lines, e.g. [8,12,2]</span>
<span class="sd">  *errors*</span>
<span class="sd">    A list of boolean statements to indicate whether markers should display error bars of not, e.g. [True,False,False]</span>
<span class="sd">  *styles*</span>
<span class="sd">    A list indicating whether each legend item should display a point &#39;p&#39; or a line &#39;l&#39;, e.g. [&#39;p&#39;,&#39;p&#39;,&#39;l&#39;]</span>
<span class="sd">  *overplot*</span>
<span class="sd">    The axes to draw the legend on (defaults to the active axes)</span>
<span class="sd">  *fontsize*</span>
<span class="sd">    The fontsize of the legend text</span>
<span class="sd">  *loc*</span>
<span class="sd">    The 0-8 integer location of the legend</span>
<span class="sd">  *ncol*</span>
<span class="sd">    The integer number of columns to divide the legend markers into</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">ax</span> <span class="o">=</span> <span class="n">overplot</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
  <span class="n">handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">xerr</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">r</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">r</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">m</span> <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;p&#39;</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">m</span> <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;l&#39;</span> <span class="k">else</span> <span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span> <span class="k">if</span> <span class="n">m</span><span class="o">==</span><span class="s">&#39;:&#39;</span> <span class="k">else</span> <span class="mi">2</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">markers</span> <span class="ow">or</span> <span class="p">[</span><span class="s">&#39;o&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">],</span> <span class="n">colors</span><span class="p">,</span> <span class="n">edges</span> <span class="ow">or</span> <span class="n">colors</span><span class="p">,</span> <span class="n">sizes</span> <span class="ow">or</span> <span class="p">[</span><span class="mi">10</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">],</span> <span class="n">errors</span> <span class="ow">or</span> <span class="p">[</span><span class="bp">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">],</span> <span class="n">styles</span> <span class="ow">or</span> <span class="p">[</span><span class="s">&#39;p&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">])]</span>
  <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">figlegend</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figlegend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">figlegend</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">handletextpad</span><span class="o">=</span><span class="mi">1</span> <span class="k">if</span> <span class="s">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">styles</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">handleheight</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">handlelength</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">add_legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">handletextpad</span><span class="o">=</span><span class="mi">1</span> <span class="k">if</span> <span class="s">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">styles</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">handleheight</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">handlelength</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;expand&quot;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span> <span class="k">if</span> <span class="n">bbox_to_anchor</span> <span class="k">else</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">handletextpad</span><span class="o">=</span><span class="mi">1</span> <span class="k">if</span> <span class="s">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">styles</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">handleheight</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">handlelength</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">add_legend</span><span class="p">)</span>    
</div>
<div class="viewcode-block" id="marginalized_distribution"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.marginalized_distribution">[docs]</a><span class="k">def</span> <span class="nf">marginalized_distribution</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">xunits</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">yunits</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">contour</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">figure</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="n">figure</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax1</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">xy</span><span class="p">:</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">xy</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">6</span>
  <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">:</span><span class="mi">100j</span><span class="p">,</span> <span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">:</span><span class="mi">100j</span><span class="p">]</span>
  <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
  <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
  <span class="n">kernel</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
  <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">kernel</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
  <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">]),</span> <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">]),</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">Z</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">),</span> <span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">24</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">&#39;mid&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span> <span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">&#39;mid&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span> <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span> <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span> <span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span> <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">(),</span> <span class="n">ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
  <span class="n">T</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">st</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">st</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">teff</span><span class="p">,</span> <span class="n">teff_frac</span><span class="p">,</span> <span class="n">logg</span><span class="p">,</span> <span class="n">logg_frac</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">G</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
  <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">teff</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;#ffffff&#39;</span><span class="p">),</span> <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">logg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;#ffffff&#39;</span><span class="p">),</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">teff</span><span class="p">,</span> <span class="n">logg</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Teff&#39;</span><span class="p">),</span> <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;log(g)&#39;</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;{} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">teff</span><span class="p">,</span><span class="n">logg</span><span class="p">)),</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">save</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">teff</span><span class="p">,</span> <span class="n">teff_frac</span><span class="p">,</span> <span class="n">logg</span><span class="p">,</span> <span class="n">logg_frac</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
</div>
<div class="viewcode-block" id="montecarlo"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.montecarlo">[docs]</a><span class="k">def</span> <span class="nf">montecarlo</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">modelDict</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[],</span> <span class="n">save</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  For given *spectrum* and dictionary of models *modelDict*, runs a Monte Carlo simulation *N* times on each model</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">G</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">modelDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">rebin_spec</span><span class="p">([</span><span class="n">modelDict</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s">&#39;wavelength&#39;</span><span class="p">],</span><span class="n">modelDict</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s">&#39;flux&#39;</span><span class="p">]],</span> <span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">N</span><span class="p">):</span> <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">goodness</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="p">[</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span><span class="o">*</span><span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">model</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">p</span><span class="p">))</span>
    <span class="n">G</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
  <span class="n">bests</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">G</span><span class="p">)]</span>
  <span class="n">fits</span><span class="p">,</span> <span class="n">teff</span><span class="p">,</span> <span class="n">logg</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">bests</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">marginalized_distribution</span><span class="p">([</span><span class="n">teff</span><span class="p">,</span> <span class="n">logg</span><span class="p">,</span> <span class="n">fits</span><span class="p">,</span> <span class="n">params</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="modelFit"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.modelFit">[docs]</a><span class="k">def</span> <span class="nf">modelFit</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">photometry</span><span class="p">,</span> <span class="n">photDict</span><span class="p">,</span> <span class="n">specDict</span><span class="p">,</span> <span class="n">filtDict</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">sig_d</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[],</span> <span class="n">plot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">Rlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">Tlim</span><span class="o">=</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span><span class="mi">3000</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  For given *spectrum* [W,F,E] or dictionary of photometry, returns the best fit synthetic spectrum by varying surface gravity and effective temperature.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">photometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="s">&#39;unc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">photometry</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">photometry</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s">&#39;_unc&#39;</span><span class="p">]:</span> <span class="n">photometry</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">photometry</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="s">&#39;_unc&#39;</span><span class="p">)</span>
  
  <span class="n">fit_list</span><span class="p">,</span> <span class="n">unfit_list</span><span class="p">,</span> <span class="n">phot_fit</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="bp">False</span>
  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">specDict</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">w</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">specDict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;wavelength&#39;</span><span class="p">],</span> <span class="n">specDict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;flux&#39;</span><span class="p">]</span> 
      <span class="n">good</span><span class="p">,</span> <span class="n">const</span> <span class="o">=</span> <span class="n">goodness</span><span class="p">(</span><span class="n">photometry</span> <span class="k">if</span> <span class="n">phot_fit</span> <span class="k">else</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">phot_fit</span> <span class="k">else</span> <span class="n">rebin_spec</span><span class="p">([</span><span class="n">specDict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;wavelength&#39;</span><span class="p">],</span><span class="n">specDict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;flux&#39;</span><span class="p">]],</span> <span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">waveunits</span><span class="o">=</span><span class="s">&#39;um&#39;</span><span class="p">),</span> <span class="n">filt_dict</span><span class="o">=</span><span class="n">filtDict</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">)</span>
      <span class="n">R</span><span class="p">,</span> <span class="n">sig_R</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">const</span><span class="p">))</span><span class="o">/</span><span class="n">ac</span><span class="o">.</span><span class="n">R_jup</span><span class="p">)</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">sig_d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">const</span><span class="p">))</span><span class="o">/</span><span class="n">ac</span><span class="o">.</span><span class="n">R_jup</span><span class="p">)</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">sig_d</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
      <span class="k">if</span> <span class="n">R</span><span class="o">&gt;</span><span class="n">Rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">R</span><span class="o">&lt;</span><span class="n">Rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">good</span><span class="p">),</span> <span class="n">k</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">const</span><span class="p">),</span> <span class="n">R</span><span class="p">,</span> <span class="n">sig_R</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span><span class="n">f</span><span class="o">*</span><span class="n">const</span><span class="p">]])</span>
      <span class="k">else</span><span class="p">:</span> <span class="n">unfit_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">good</span><span class="p">),</span> <span class="n">k</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">const</span><span class="p">),</span> <span class="n">R</span><span class="p">,</span> <span class="n">sig_R</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span><span class="n">f</span><span class="o">*</span><span class="n">const</span><span class="p">]])</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
  
  <span class="n">best</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fit_list</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">best_unc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
  <span class="n">best_unc</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">photometry</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">photometry</span> <span class="k">if</span> <span class="s">&#39;unc&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">photometry</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
  <span class="n">final_spec</span> <span class="o">=</span> <span class="p">[</span><span class="n">best</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">best</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span> <span class="n">best_unc</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="p">]</span>

  <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">groupby</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">to_print</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(),</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ni</span><span class="p">,</span><span class="n">li</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[(</span><span class="s">&#39;fl&#39;</span><span class="p">,</span><span class="n">fit_list</span><span class="p">),(</span><span class="s">&#39;ul&#39;</span><span class="p">,</span><span class="n">unfit_list</span><span class="p">)]:</span>
      <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">group</span> <span class="ow">in</span> <span class="p">[[</span><span class="n">k</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">grp</span><span class="p">)]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">grp</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">li</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])]:</span>
        <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">sp</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">p</span><span class="p">],</span> <span class="n">g</span><span class="p">,</span> <span class="s">&#39;o&#39;</span> <span class="k">if</span> <span class="n">ni</span><span class="o">==</span><span class="s">&#39;fl&#39;</span> <span class="k">else</span> <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span> <span class="k">if</span> <span class="n">ni</span><span class="o">==</span><span class="s">&#39;fl&#39;</span> <span class="k">else</span> <span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">((</span><span class="mf">5.6</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="o">/</span><span class="mf">2.4</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">key</span> <span class="k">if</span> <span class="n">ni</span><span class="o">==</span><span class="s">&#39;fl&#39;</span> <span class="k">else</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">to_print</span> <span class="o">+=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">p</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">l</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Goodness of Fit&#39;</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Teff&#39;</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save</span><span class="o">+</span><span class="s">&#39; - fit plot.png&#39;</span><span class="p">)</span><span class="c">#, printer([&#39;Params&#39;,&#39;G&#39;,&#39;radius&#39;,&#39;Lbol&#39;], to_print, to_txt=save+&#39; - fit.txt&#39;)</span>

  <span class="k">return</span> <span class="p">[</span><span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">best</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
  <span class="c"># return [final_spec, best[1], best[2], best[3], best[4], best[5]]</span>
</div>
<div class="viewcode-block" id="modelInterp"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.modelInterp">[docs]</a><span class="k">def</span> <span class="nf">modelInterp</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">model_dict</span><span class="p">,</span> <span class="n">filt_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Returns the interpolated model atmosphere spectrum (if model_dict==spec_dict) or photometry (if model_dict==phot_dict and filt_dict provided)</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">t</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">params</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">2</span><span class="p">,[[</span><span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">t</span><span class="p">),</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">k</span><span class="p">]))[</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
  <span class="k">if</span> <span class="n">filt_dict</span><span class="p">:</span>
    <span class="n">D</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filt_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">try</span><span class="p">:</span> 
        <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">p2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">p1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">model_dict</span><span class="p">[</span><span class="n">p2</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">4</span><span class="o">-</span><span class="n">t2</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">t1</span><span class="o">**</span><span class="mi">4</span><span class="o">-</span><span class="n">t2</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">filt_dict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;eff&#39;</span><span class="p">],</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">p1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="s">&#39;bo&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">p1</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="s">&#39;J&#39;</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">filt_dict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;eff&#39;</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">params</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="s">&#39;J&#39;</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">filt_dict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;eff&#39;</span><span class="p">],</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">p2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="s">&#39;go&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">p2</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="s">&#39;J&#39;</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="k">pass</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">D</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">w1</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">p1</span><span class="p">][</span><span class="s">&#39;wavelength&#39;</span><span class="p">],</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">p1</span><span class="p">][</span><span class="s">&#39;flux&#39;</span><span class="p">],</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">p2</span><span class="p">][</span><span class="s">&#39;wavelength&#39;</span><span class="p">],</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">p2</span><span class="p">][</span><span class="s">&#39;flux&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">f2</span><span class="p">):</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">f2</span><span class="o">+</span><span class="p">(</span><span class="n">f1</span><span class="o">-</span><span class="n">f2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">4</span><span class="o">-</span><span class="n">t2</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">t1</span><span class="o">**</span><span class="mi">4</span><span class="o">-</span><span class="n">t2</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="s">&#39;-b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="s">&#39;-r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="s">&#39;-g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">w1</span><span class="p">,</span><span class="n">F</span><span class="p">]</span>
  </div>
<div class="viewcode-block" id="modelReplace"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.modelReplace">[docs]</a><span class="k">def</span> <span class="nf">modelReplace</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="p">[],</span> <span class="n">tails</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Returns the given *spectrum* with the tuple termranges in *replace* replaced by the given *model*.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">Spec</span><span class="p">,</span> <span class="n">mSpec</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;unit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">spectrum</span><span class="p">,</span><span class="n">model</span><span class="p">]]</span>
  <span class="k">if</span> <span class="n">tails</span><span class="p">:</span> <span class="n">replace</span> <span class="o">+=</span> <span class="p">[(</span><span class="mf">0.3</span><span class="p">,</span><span class="n">Spec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),(</span><span class="n">Spec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">30</span><span class="p">)]</span>
  <span class="n">Spec</span><span class="p">,</span> <span class="n">mSpec</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">idx_exclude</span><span class="p">(</span><span class="n">Spec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">replace</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Spec</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">idx_include</span><span class="p">(</span><span class="n">mSpec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">replace</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mSpec</span><span class="p">]</span>
  <span class="n">newSpec</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Spec</span><span class="p">,</span><span class="n">mSpec</span><span class="p">)]),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
  <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(),</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="o">*</span><span class="n">model</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="o">*</span><span class="n">spectrum</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="o">*</span><span class="n">newSpec</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">newSpec</span><span class="p">,[</span><span class="n">k</span><span class="o">.</span><span class="n">unit</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s">&#39;unit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">spectrum</span><span class="p">])]</span>
</div>
<div class="viewcode-block" id="multiplot"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.multiplot">[docs]</a><span class="k">def</span> <span class="nf">multiplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">xlabelpad</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ylabelpad</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Creates subplots with given number or *rows* and *columns*.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">ylabel</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">columns</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">ylabelpad</span> <span class="ow">or</span> <span class="n">fontsize</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">ylabel</span><span class="p">):</span> <span class="n">a</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">xlabelpad</span> <span class="ow">or</span> <span class="n">fontsize</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">xlabel</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">rows</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">ylabelpad</span> <span class="ow">or</span> <span class="n">fontsize</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">xlabel</span><span class="p">):</span> <span class="n">a</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">xlabelpad</span> <span class="ow">or</span> <span class="n">fontsize</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">),</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">fig</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="norm_spec"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.norm_spec">[docs]</a><span class="k">def</span> <span class="nf">norm_spec</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[],</span> <span class="n">include</span><span class="o">=</span><span class="p">[]):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Returns *spectrum* with [W,F] or [W,F,E] normalized to *template* [W,F] or [W,F,E].</span>
<span class="sd">  Wavelength range tuples provided in *exclude* argument are ignored during normalization, i.e. exclude=[(0.65,0.72),(0.92,0.97)].</span>
<span class="sd">  &#39;&#39;&#39;</span>              
  <span class="n">S</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">scrub</span><span class="p">(</span><span class="n">spectrum</span><span class="p">),</span> <span class="n">scrub</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
  <span class="n">S0</span><span class="p">,</span> <span class="n">T0</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">idx_include</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">],[(</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])])]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">S</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">idx_include</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],[(</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])])]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">T</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">S0</span><span class="p">,</span> <span class="n">T0</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="p">[</span><span class="n">idx_exclude</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">exclude</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">S0</span><span class="p">,</span><span class="n">T0</span><span class="p">]]</span>
  <span class="k">if</span> <span class="n">include</span><span class="p">:</span> <span class="n">S0</span><span class="p">,</span> <span class="n">T0</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="p">[</span><span class="n">idx_include</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">include</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">S0</span><span class="p">,</span><span class="n">T0</span><span class="p">]]</span>
  <span class="k">try</span><span class="p">:</span> <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">T0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">T0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">rebin_spec</span><span class="p">(</span><span class="n">S0</span><span class="p">,</span> <span class="n">T0</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">T0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="n">norm</span> <span class="o">=</span> <span class="mi">1</span>            
  <span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">norm</span>                                                                              
  <span class="k">try</span><span class="p">:</span> <span class="n">S</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="n">norm</span>                                                        
  <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span> <span class="k">pass</span>
  <span class="k">return</span> <span class="n">S</span>
</div>
<div class="viewcode-block" id="norm_to_mag"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.norm_to_mag">[docs]</a><span class="k">def</span> <span class="nf">norm_to_mag</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span> 
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Returns the flux of a given *spectrum* [W,F] normalized to the given *magnitude* in the specified photometric *band*</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">magnitude</span><span class="o">/</span><span class="n">s</span><span class="o">.</span><span class="n">get_mag</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">to_flux</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">Flam</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</div>
<div class="viewcode-block" id="group_spectra"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.group_spectra">[docs]</a><span class="k">def</span> <span class="nf">group_spectra</span><span class="p">(</span><span class="n">spectra</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Puts a list of *spectra* into groups with overlapping wavelength arrays</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">groups</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="s">&#39;wavelength&#39;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">N</span><span class="p">,</span><span class="n">S</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spectra</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">N</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
      <span class="n">group</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">S</span><span class="p">],</span> <span class="n">idx</span><span class="o">+</span><span class="p">[</span><span class="n">N</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spectra</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idx</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]):</span> <span class="n">group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
      <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">groups</span>
  </div>
<div class="viewcode-block" id="make_composite"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.make_composite">[docs]</a><span class="k">def</span> <span class="nf">make_composite</span><span class="p">(</span><span class="n">spectra</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Creates a composite spectrum from a list of overlapping *spectra*</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">spectrum</span> <span class="o">=</span> <span class="n">spectra</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">spectra</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;unit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">spectra</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">spectra</span><span class="p">:</span>
    <span class="n">spectra</span> <span class="o">=</span> <span class="p">[</span><span class="n">norm_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">)</span> <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">spectra</span><span class="p">]</span>
    <span class="n">spectra</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;unit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">]</span> <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">spectra</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">spec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spectra</span><span class="p">):</span>
      <span class="n">IDX</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
      <span class="c"># if len(IDX)&lt;len(idx): low_res, highres = [i[IDX] for i in spectrum], rebin_spec([i[idx] for i in spec], spectrum[0][IDX])</span>
      <span class="c"># else: low_res, high_res, IDX = rebin_spec([i[IDX] for i in spectrum], spec[0][idx]), [i[idx] for i in spec], idx</span>
      <span class="n">low_res</span><span class="p">,</span> <span class="n">high_res</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">IDX</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spectrum</span><span class="p">],</span> <span class="n">rebin_spec</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">],</span> <span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">IDX</span><span class="p">])</span>
      <span class="n">mean_spec</span> <span class="o">=</span> <span class="p">[</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">IDX</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="n">hf</span><span class="p">,</span><span class="n">lf</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="n">he</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">le</span><span class="p">])</span> <span class="k">for</span> <span class="n">hf</span><span class="p">,</span><span class="n">he</span><span class="p">,</span><span class="n">lf</span><span class="p">,</span><span class="n">le</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">high_res</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">high_res</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">low_res</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">low_res</span><span class="p">[</span><span class="mi">2</span><span class="p">])]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">low_res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">high_res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)]</span>
      <span class="n">spec1</span><span class="p">,</span> <span class="n">spec2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">spec1</span><span class="p">,</span> <span class="n">spec2</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spec1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">IDX</span><span class="p">][</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spec1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spec2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">IDX</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spec2</span><span class="p">]</span>
      <span class="n">spectrum</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">i</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">spec1</span><span class="p">,</span><span class="n">mean_spec</span><span class="p">,</span><span class="n">spec2</span><span class="p">)]</span>
  <span class="k">return</span> <span class="n">spectrum</span>
  
  <span class="c"># spectrum = spectra.pop(0)</span>
  <span class="c"># if spectra:</span>
  <span class="c">#   spectra = [norm_spec(spec, spectrum) for spec in spectra]</span>
  <span class="c">#   for n,spec in enumerate(spectra):</span>
  <span class="c">#     IDX, idx = np.where(np.logical_and(spectrum[0]&lt;spec[0][-1],spectrum[0]&gt;spec[0][0]))[0], np.where(np.logical_and(spec[0]&gt;spectrum[0][0],spec[0]&lt;spectrum[0][-1]))[0]</span>
  <span class="c">#     print spectrum[0]</span>
  <span class="c">#     low_res, high_res = [i[IDX] for i in spectrum], rebin_spec([i[idx] for i in spec], spectrum[0][IDX])</span>
  <span class="c">#     mean_spec = [spectrum[0][IDX], np.array([np.average([hf,lf], weights=[1/he,1/le]) for hf,he,lf,le in zip(high_res[1],high_res[2],low_res[1],low_res[2])]), np.sqrt(low_res[2]**2 + high_res[2]**2)]</span>
  <span class="c">#     spec1, spec2 = min(spectrum, spec, key=lambda x: x[0][0]), max(spectrum, spec, key=lambda x: x[0][-1])</span>
  <span class="c">#     spec1, spec2 = [i[np.where(spec1[0]&lt;spectrum[0][IDX][0])[0]] for i in spec1], [i[np.where(spec2[0]&gt;spectrum[0][IDX][-1])[0]] for i in spec2]</span>
  <span class="c">#     spectrum = [np.concatenate([i[:-1],j[1:-1],k[1:]]) for i,j,k in zip(spec1,mean_spec,spec2)]</span>
  <span class="c"># return spectrum</span>
</div>
<div class="viewcode-block" id="normalize"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.normalize">[docs]</a><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">spectra</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">composite</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">SNR</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[],</span> <span class="n">trim</span><span class="o">=</span><span class="p">[],</span> <span class="n">replace</span><span class="o">=</span><span class="p">[],</span> <span class="n">D_Flam</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Normalizes a list of *spectra* with [W,F,E] or [W,F] to a *template* spectrum.</span>
<span class="sd">  Returns one normalized, composite spectrum if *composite*, else returns the list of *spectra* normalized to the *template*.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">template</span><span class="p">:</span> 
    <span class="n">spectra</span> <span class="o">=</span> <span class="p">[</span><span class="n">scrub</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">spectra</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">spectra</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        
  <span class="k">if</span> <span class="n">trim</span><span class="p">:</span>
    <span class="n">all_spec</span> <span class="o">=</span> <span class="p">[</span><span class="n">template</span><span class="p">]</span><span class="o">+</span><span class="n">spectra</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span> <span class="ow">in</span> <span class="n">trim</span><span class="p">:</span> <span class="n">all_spec</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">idx_exclude</span><span class="p">(</span><span class="n">all_spec</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],[(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)])]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_spec</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
    <span class="n">template</span><span class="p">,</span> <span class="n">spectra</span> <span class="o">=</span> <span class="n">all_spec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">all_spec</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_spec</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="bp">None</span>
  
  <span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">E</span><span class="p">),</span> <span class="n">normalized</span> <span class="o">=</span> <span class="n">scrub</span><span class="p">(</span><span class="n">template</span><span class="p">),</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="n">spectra</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">S</span> <span class="ow">in</span> <span class="n">spectra</span><span class="p">:</span> <span class="n">normalized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">norm_spec</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">[</span><span class="n">W</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">E</span><span class="p">],</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="o">+</span><span class="n">replace</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> 
      <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">F</span><span class="o">-</span><span class="n">E</span><span class="p">,</span> <span class="n">F</span><span class="o">+</span><span class="n">E</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">w</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="n">normalized</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="o">-</span><span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="o">+</span><span class="n">e</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">composite</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">n</span><span class="p">,(</span><span class="n">w</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">normalized</span><span class="p">):</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">tries</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">:</span>
          <span class="n">IDX</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">W</span><span class="o">&lt;</span><span class="n">w</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">W</span><span class="o">&gt;</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">w</span><span class="o">&gt;</span><span class="n">W</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">w</span><span class="o">&lt;</span><span class="n">W</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">IDX</span><span class="p">):</span>
            <span class="n">normalized</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">normalized</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">w</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">e</span><span class="p">])</span>
            <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">IDX</span><span class="p">)</span><span class="o">&lt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span> <span class="p">(</span><span class="n">W0</span><span class="p">,</span> <span class="n">F0</span><span class="p">,</span> <span class="n">E0</span><span class="p">),</span> <span class="p">(</span><span class="n">w0</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">e0</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">IDX</span><span class="p">]</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">W</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">E</span><span class="p">]],</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">e</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span> <span class="p">(</span><span class="n">W0</span><span class="p">,</span> <span class="n">F0</span><span class="p">,</span> <span class="n">E0</span><span class="p">),</span> <span class="p">(</span><span class="n">w0</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">e0</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">e</span><span class="p">]],</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">IDX</span><span class="p">]</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">W</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">E</span><span class="p">]]</span>
            <span class="n">f0</span><span class="p">,</span> <span class="n">e0</span> <span class="o">=</span> <span class="n">rebin_spec</span><span class="p">([</span><span class="n">w0</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="n">e0</span><span class="p">],</span> <span class="n">W0</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">f_mean</span><span class="p">,</span> <span class="n">e_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="n">fl</span><span class="p">,</span><span class="n">FL</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="n">er</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">ER</span><span class="p">])</span> <span class="k">for</span> <span class="n">fl</span><span class="p">,</span><span class="n">er</span><span class="p">,</span><span class="n">FL</span><span class="p">,</span><span class="n">ER</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span><span class="n">e0</span><span class="p">,</span><span class="n">F0</span><span class="p">,</span><span class="n">E0</span><span class="p">)]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">e0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">E0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>            
            <span class="n">spec1</span><span class="p">,</span> <span class="n">spec2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">W</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">E</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">e</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">([</span><span class="n">W</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">E</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">e</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">spec1</span><span class="p">,</span> <span class="n">spec2</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spec1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">W0</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spec1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spec2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">W0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spec2</span><span class="p">]</span>
            <span class="n">W</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">i</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">spec1</span><span class="p">,[</span><span class="n">W0</span><span class="p">,</span><span class="n">f_mean</span><span class="p">,</span><span class="n">e_mean</span><span class="p">],</span><span class="n">spec2</span><span class="p">)]</span>
            <span class="n">tries</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">normalized</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">replace</span><span class="p">:</span> <span class="n">W</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">modelReplace</span><span class="p">([</span><span class="n">W</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">E</span><span class="p">],</span> <span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">,</span> <span class="n">D_Flam</span><span class="o">=</span><span class="n">D_Flam</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">composite</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="s">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">F</span><span class="o">-</span><span class="n">E</span><span class="p">,</span> <span class="n">F</span><span class="o">+</span><span class="n">E</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">,</span> <span class="n">nonposy</span><span class="o">=</span><span class="s">&#39;clip&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">composite</span><span class="p">:</span> <span class="n">normalized</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">normalized</span> <span class="o">=</span> <span class="p">[[</span><span class="n">W</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">E</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">normalized</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="nb">len</span><span class="p">(</span><span class="n">template</span><span class="p">)]</span> <span class="k">if</span> <span class="n">composite</span> <span class="k">else</span> <span class="n">normalized</span>
  <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">W</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">E</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="pi2pc"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.pi2pc">[docs]</a><span class="k">def</span> <span class="nf">pi2pc</span><span class="p">(</span><span class="n">parallax</span><span class="p">,</span> <span class="n">parallax_unc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pc2pi</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">parallax</span><span class="p">:</span> 
    <span class="k">if</span> <span class="n">pc2pi</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">((</span><span class="mi">1</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">pc</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">arcsec</span><span class="p">)</span><span class="o">/</span><span class="n">parallax</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">mas</span><span class="p">),</span> <span class="p">(</span><span class="n">parallax_unc</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">pc</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">arcsec</span><span class="o">/</span><span class="n">parallax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">mas</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">pi</span><span class="p">,</span> <span class="n">sig_pi</span> <span class="o">=</span> <span class="n">parallax</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">arcsec</span><span class="o">/</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">parallax_unc</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">arcsec</span><span class="o">/</span><span class="mf">1000.</span>
      <span class="n">d</span><span class="p">,</span> <span class="n">sig_d</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">pc</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">arcsec</span><span class="p">)</span><span class="o">/</span><span class="n">pi</span><span class="p">,</span> <span class="n">sig_pi</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">pc</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">arcsec</span><span class="o">/</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">sig_d</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="polynomial"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.polynomial">[docs]</a><span class="k">def</span> <span class="nf">polynomial</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">sig</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">output_data</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">plot_rms</span><span class="o">=</span><span class="s">&#39;0.9&#39;</span><span class="p">):</span>
  <span class="n">p</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">singular_values</span><span class="p">,</span> <span class="n">rcond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">n</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">m</span><span class="p">)),</span> <span class="n">degree</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">if</span> <span class="n">i</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sig</span><span class="p">])</span> <span class="k">if</span> <span class="n">sig</span><span class="o">!=</span><span class="s">&#39;&#39;</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
  <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="mi">50</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;${}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">poly_print</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span> <span class="k">if</span> <span class="n">legend</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
  <span class="n">rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">m</span><span class="o">-</span><span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">plot_rms</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">-</span><span class="n">rms</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="n">rms</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plot_rms</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span> <span class="n">rms</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">p</span><span class="p">))]</span>
  <span class="n">print_data</span> <span class="o">=</span> <span class="p">[[</span><span class="n">y</span><span class="p">,</span> <span class="s">r&#39;{:.1f}\textless {}\textless {:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">x</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span> <span class="s">&#39;{:.3f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span><span class="s">&#39;{:.3e}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">p</span><span class="p">))]]</span>
  <span class="n">printer</span><span class="p">([</span><span class="s">&#39;P(x)&#39;</span><span class="p">,</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;rms&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="s">r&#39;$c_{}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">))],</span> <span class="n">print_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">to_txt</span><span class="o">=</span><span class="s">&#39;/Users/Joe/Desktop/{} v {}.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">output_data</span> <span class="k">else</span> <span class="bp">False</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">data</span> 
</div>
<div class="viewcode-block" id="poly_print"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.poly_print">[docs]</a><span class="k">def</span> <span class="nf">poly_print</span><span class="p">(</span><span class="n">coeff_list</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">):</span> <span class="k">return</span> <span class="s">&#39;{} ={}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;{}{:.3e}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39; + &#39;</span> <span class="k">if</span> <span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="s">&#39; - &#39;</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s">&#39;{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span> <span class="k">if</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;^{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coeff_list</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="printer"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.printer">[docs]</a><span class="k">def</span> <span class="nf">printer</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">to_txt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="p">[],</span> <span class="n">skip</span><span class="o">=</span><span class="p">[],</span> <span class="n">empties</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Prints a nice table of *values* with *labels* with auto widths else maximum width if *same* else *col_len* if specified. </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">red</span><span class="p">(</span><span class="n">t</span><span class="p">):</span> <span class="k">print</span> <span class="s">&quot;</span><span class="se">\033</span><span class="s">[01;31m{0}</span><span class="se">\033</span><span class="s">[00m&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
  <span class="c"># if not to_txt: print &#39;\r&#39;</span>
  <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">values</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&quot;-&quot;</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;{:.6g}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="k">else</span> <span class="n">i</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,(</span><span class="nb">str</span><span class="p">,</span><span class="nb">unicode</span><span class="p">))</span> <span class="k">else</span> <span class="s">&quot;{:.6g} {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;unit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
  <span class="n">auto</span><span class="p">,</span> <span class="n">txtFile</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">])</span><span class="o">+</span><span class="mi">2</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="o">*</span><span class="n">values</span><span class="p">)],</span> <span class="nb">open</span><span class="p">(</span><span class="n">to_txt</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">to_txt</span> <span class="k">else</span> <span class="bp">None</span>
  <span class="n">lengths</span> <span class="o">=</span> <span class="n">format</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">format</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">truncate</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">auto</span><span class="p">]</span>
  <span class="n">col_len</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">auto</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">]</span> <span class="k">if</span> <span class="n">format</span><span class="o">==</span><span class="s">&#39;max&#39;</span> <span class="k">else</span> <span class="p">[</span><span class="mi">150</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">]</span> <span class="k">if</span> <span class="n">format</span><span class="o">==</span><span class="s">&#39;fill&#39;</span> <span class="k">else</span> <span class="n">lengths</span>
  
  <span class="c"># If False, remove columns with no values</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">empties</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;-&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]):</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">to_txt</span><span class="p">:</span> <span class="n">txtFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">N</span><span class="p">,(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">col_len</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">N</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">to_txt</span><span class="p">:</span> <span class="n">txtFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)[:</span><span class="n">truncate</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39; &#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)[:</span><span class="n">truncate</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span> <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)[:</span><span class="n">truncate</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">m</span><span class="p">),</span>  
  <span class="k">for</span> <span class="n">row_num</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">to_txt</span><span class="p">:</span> <span class="n">txtFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
    <span class="k">for</span> <span class="n">col_num</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">col_len</span><span class="p">)):</span>
      <span class="k">if</span> <span class="n">col_num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">to_txt</span><span class="p">:</span> <span class="n">txtFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)[:</span><span class="n">truncate</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39; &#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)[:</span><span class="n">truncate</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">row_num</span><span class="p">,</span><span class="n">col_num</span><span class="p">)</span> <span class="ow">in</span> <span class="n">highlight</span><span class="p">:</span> <span class="n">red</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)[:</span><span class="n">truncate</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
          <span class="k">else</span><span class="p">:</span> <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)[:</span><span class="n">truncate</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">j</span><span class="p">),</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">to_txt</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
</div>
<div class="viewcode-block" id="read_spec"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.read_spec">[docs]</a><span class="k">def</span> <span class="nf">read_spec</span><span class="p">(</span><span class="n">specFiles</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">atomicron</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">negtonan</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">wlog</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    (by Alejandro N |uacute| |ntilde| ez, Jocelyn Ferrara)</span>
<span class="sd">    </span>
<span class="sd">    Read spectral data from fits or ascii files. It returns a list of numpy arrays with wavelength in position 0, flux in position 1 and error values (if requested) in position 2. More than one file name can be provided simultaneously.</span>
<span class="sd">    </span>
<span class="sd">    **Limitations**: Due to a lack of set framework for ascii file headers, this function assumes ascii files to have wavelength in column 1, flux in column 2, and (optional) error in column 3. Ascii spectra are assumed to be linear, so the kwarg *linear* is disabled for ascii files. Fits files that have multiple spectral orders will not be interpreted correctly with this function.</span>
<span class="sd">    </span>
<span class="sd">    *specFiles*</span>
<span class="sd">      String with fits file name (with full path); it can also be a python list of file names.</span>
<span class="sd">    *errors*</span>
<span class="sd">      Boolean, whether to return error values for the flux data; return nans if unavailable.</span>
<span class="sd">    *atomicron*</span>
<span class="sd">      Boolean, if wavelength units are in Angstrom, whether to convert them to microns.</span>
<span class="sd">    *negtonan*</span>
<span class="sd">      Boolean, whether to set negative flux values equal to zero.</span>
<span class="sd">    *plot*</span>
<span class="sd">      Boolean, whether to plot the spectral data, including error bars when available.</span>
<span class="sd">    *linear*</span>
<span class="sd">      Boolean, whether to return spectrum only if it is linear. If it cannot verify linearity, it will assume linearity.</span>
<span class="sd">    *verbose*</span>
<span class="sd">      Boolean, whether to print warning messages.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c"># 1. Convert specFiles into a list type if it is only one file name</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">specFiles</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">specFiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">specFiles</span><span class="p">,]</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">specFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;File name(s) in invalid format.&#39;</span>
        <span class="k">return</span>
    
    <span class="c"># 2. Initialize array to store spectra</span>
    <span class="n">specData</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">specFiles</span><span class="p">)</span>
    
    <span class="c"># 3. Loop through each file name:</span>
    <span class="k">for</span> <span class="n">spFileIdx</span><span class="p">,</span><span class="n">spFile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">specFiles</span><span class="p">):</span>
        
        <span class="c"># 3.1 Determine the type of file it is</span>
        <span class="n">isFits</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">spFile</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">&#39;fits&#39;</span> <span class="ow">or</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">&#39;.fit&#39;</span><span class="p">:</span>
            <span class="n">isFits</span> <span class="o">=</span> <span class="bp">True</span>
            
        <span class="c"># 3.2. Get data from file</span>
        <span class="k">if</span> <span class="n">isFits</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fitsData</span><span class="p">,</span> <span class="n">fitsHeader</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">spFile</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Could not open &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spFile</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span>
                <span class="k">continue</span>
        <span class="c"># Assume ascii file otherwise (isFits = False)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">aData</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">spFile</span><span class="p">)</span>
                <span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tonumpy</span><span class="p">(),</span> <span class="n">aData</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tonumpy</span><span class="p">()]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aData</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">errors</span><span class="p">:</span>
                    <span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aData</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">tonumpy</span><span class="p">())</span>
                <span class="c"># # Check (when header available) whether data is linear.</span>
                <span class="c"># if aData.header:</span>
                <span class="c">#     lindex = str(aData.header).upper().find(&#39;LINEAR&#39;)</span>
                <span class="c">#     if lindex == -1:</span>
                <span class="c">#         isLinear = False</span>
                <span class="c">#     else:</span>
                <span class="c">#         isLinear = True</span>
                <span class="c">#     if linear and not isLinear:</span>
                <span class="c">#         if verbose:</span>
                <span class="c">#             print &#39;Data in &#39; + spFile + &#39; is not linear.&#39;</span>
                <span class="c">#         return</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Could not open &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spFile</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span>
                <span class="k">continue</span>
        
        <span class="c"># 3.3. Check if data in fits file is linear</span>
        <span class="k">if</span> <span class="n">isFits</span><span class="p">:</span>
            <span class="n">KEY_TYPE</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;CTYPE1&#39;</span><span class="p">]</span>
            <span class="n">setType</span>  <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">KEY_TYPE</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fitsHeader</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">setType</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;Data in &#39;</span> <span class="o">+</span> <span class="n">spFile</span> <span class="o">+</span> <span class="s">&#39; assumed to be linear.&#39;</span>
                <span class="n">isLinear</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">valType</span> <span class="o">=</span> <span class="n">fitsHeader</span><span class="p">[</span><span class="n">setType</span><span class="o">.</span><span class="n">pop</span><span class="p">()]</span>
                <span class="k">if</span> <span class="n">valType</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;LINEAR&#39;</span><span class="p">:</span>
                    <span class="n">isLinear</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">isLinear</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">linear</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">isLinear</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;Data in &#39;</span> <span class="o">+</span> <span class="n">spFile</span> <span class="o">+</span> <span class="s">&#39; is not linear.&#39;</span>
                <span class="k">return</span>
        
        <span class="c"># 3.4. Get wl, flux &amp; error data from fits file</span>
        <span class="c">#      (returns wl in pos. 0, flux in pos. 1, error values in pos. 2)</span>
        <span class="k">if</span> <span class="n">isFits</span><span class="p">:</span>
            <span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">]</span> <span class="o">=</span> <span class="n">__get_spec</span><span class="p">(</span><span class="n">fitsData</span><span class="p">,</span> <span class="n">fitsHeader</span><span class="p">,</span> <span class="n">spFile</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> \
                                             <span class="n">verb</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">continue</span>
        
            <span class="c"># Generate wl axis when needed</span>
            <span class="k">if</span> <span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">__create_waxis</span><span class="p">(</span><span class="n">fitsHeader</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">spFile</span><span class="p">,</span> <span class="n">wlog</span><span class="o">=</span><span class="n">wlog</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="c"># If no wl axis generated, then clear out all retrieved data for object</span>
            <span class="k">if</span> <span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">continue</span>
        
        <span class="c"># 3.5. Convert units in wl-axis from Angstrom into microns if desired</span>
        <span class="k">if</span> <span class="n">atomicron</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">8000</span><span class="p">:</span>
                <span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10000</span>
        
        <span class="c"># 3.6. Set negative flux values equal to zero (next step sets them to nans)</span>
        <span class="k">if</span> <span class="n">negtonan</span><span class="p">:</span>
            <span class="n">negIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">negIdx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">negIdx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;</span><span class="si">%i</span><span class="s"> negative data points found in </span><span class="si">%s</span><span class="s">.&#39;</span> \
                            <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">negIdx</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">spFile</span><span class="p">)</span>
        
        <span class="c"># 3.7. Set zero flux values as nans (do this always)</span>
        <span class="n">zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zeros</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">specData</span><span class="p">[</span><span class="n">spFileIdx</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zeros</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        
    
    <span class="c"># 4. Plot the spectra if desired</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plot_spec</span><span class="p">(</span><span class="n">specData</span><span class="p">,</span> <span class="n">ploterrors</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c"># 5. Clear up memory</span>
    <span class="n">fitsHeader</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">fitsData</span>   <span class="o">=</span> <span class="s">&#39;&#39;</span>
    
    <span class="k">return</span> <span class="n">specData</span>
</div>
<div class="viewcode-block" id="rebin_spec"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.rebin_spec">[docs]</a><span class="k">def</span> <span class="nf">rebin_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">wavnew</span><span class="p">,</span> <span class="n">waveunits</span><span class="o">=</span><span class="s">&#39;um&#39;</span><span class="p">):</span>
  <span class="kn">from</span> <span class="nn">pysynphot</span> <span class="kn">import</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">observation</span>
  <span class="c"># Gives same error answer: Err = np.array([np.sqrt(sum(spec[2].value[idx_include(wavnew,[((wavnew[0] if n==0 else wavnew[n-1]+wavnew[n])/2,wavnew[-1] if n==len(wavnew) else (wavnew[n]+wavnew[n+1])/2)])]**2)) for n in range(len(wavnew)-1)])*spec[2].unit if spec[2] is not &#39;&#39; else &#39;&#39;</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> <span class="n">spec</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>
  <span class="k">try</span><span class="p">:</span> <span class="n">Flx</span><span class="p">,</span> <span class="n">Err</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">ArraySourceSpectrum</span><span class="p">(</span><span class="n">wave</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">ArraySourceSpectrum</span><span class="p">(</span><span class="n">wave</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">ArraySpectralElement</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">waveunits</span><span class="o">=</span><span class="n">waveunits</span><span class="p">)</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="n">spec</span><span class="p">,</span> <span class="n">wavnew</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">],</span> <span class="n">wavnew</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">Flx</span><span class="p">,</span> <span class="n">Err</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">ArraySourceSpectrum</span><span class="p">(</span><span class="n">wave</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">ArraySourceSpectrum</span><span class="p">(</span><span class="n">wave</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">ArraySpectralElement</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">waveunits</span><span class="o">=</span><span class="n">waveunits</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">wavnew</span><span class="p">,</span> <span class="n">observation</span><span class="o">.</span><span class="n">Observation</span><span class="p">(</span><span class="n">Flx</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="n">binset</span><span class="o">=</span><span class="n">wavnew</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="s">&#39;taper&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">binflux</span><span class="o">*</span><span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">observation</span><span class="o">.</span><span class="n">Observation</span><span class="p">(</span><span class="n">Err</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="n">binset</span><span class="o">=</span><span class="n">wavnew</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="s">&#39;taper&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">binflux</span><span class="o">*</span><span class="n">spec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span> <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wavnew</span><span class="p">))</span><span class="o">*</span><span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">]</span>

<span class="c"># def rebin_spec(spec, wavnew, waveunits=&#39;um&#39;):</span>
<span class="c">#   from pysynphot import spectrum</span>
<span class="c">#   # Gives same error answer: Err = np.array([np.sqrt(sum(spec[2].value[idx_include(wavnew,[((wavnew[0] if n==0 else wavnew[n-1]+wavnew[n])/2,wavnew[-1] if n==len(wavnew) else (wavnew[n]+wavnew[n+1])/2)])]**2)) for n in range(len(wavnew)-1)])*spec[2].unit if spec[2] is not &#39;&#39; else &#39;&#39;</span>
<span class="c">#   Flx = spectrum.ArraySourceSpectrum(wave=spec[0].value, flux=spec[1].value)</span>
<span class="c">#   if len(spec)==2: Err = [&#39;&#39;]</span>
<span class="c">#   else: Err = spectrum.ArraySourceSpectrum(wave=spec[0].value, flux=spec[2].value)</span>
<span class="c">#   filt = spectrum.ArraySpectralElement(spec[0].value, np.ones(len(spec[0])), waveunits=waveunits)</span>
<span class="c">#   f = observation.Observation(Flx, filt, binset=wavnew.value, force=&#39;taper&#39;).binflux*spec[1].unit</span>
<span class="c">#   e = (observation.Observation(Err, filt, binset=wavnew.value, force=&#39;taper&#39;).binflux if Err!=[&#39;&#39;] else np.ones(len(wavnew)))*spec[1].unit</span>
<span class="c">#   return [wavnew, f, e]</span>
</div>
<div class="viewcode-block" id="rgb_image"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.rgb_image">[docs]</a><span class="k">def</span> <span class="nf">rgb_image</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Saves an RGB false color image at *save* made from a stack of three *images*</span>
<span class="sd">  From the APLpy (Apple Pie) module (http://aplpy.readthedocs.org/en/latest/howto_rgb.html)</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">import</span> <span class="nn">aplpy</span>
  <span class="n">aplpy</span><span class="o">.</span><span class="n">make_rgb_image</span><span class="p">(</span><span class="n">images</span><span class="p">,</span><span class="n">save</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="separation"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.separation">[docs]</a><span class="k">def</span> <span class="nf">separation</span><span class="p">(</span><span class="n">ra1</span><span class="p">,</span> <span class="n">dec1</span><span class="p">,</span> <span class="n">ra2</span><span class="p">,</span> <span class="n">dec2</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Given coordinates *ra1*, *dec1*, *ra2*, *dec2* of two objects, returns the angular separation in arcseconds.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ra1</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="n">ra1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ra1</span><span class="p">)</span> <span class="k">if</span> <span class="n">ra1</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="n">sxg2deg</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">ra1</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dec1</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="n">dec1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dec1</span><span class="p">)</span> <span class="k">if</span> <span class="n">dec1</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="n">sxg2deg</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="n">dec1</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ra2</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="n">ra2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ra2</span><span class="p">)</span> <span class="k">if</span> <span class="n">ra2</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="n">sxg2deg</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">ra2</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dec2</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="n">dec2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dec2</span><span class="p">)</span> <span class="k">if</span> <span class="n">dec2</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="n">sxg2deg</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="n">dec2</span><span class="p">)</span> 

  <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">apc</span><span class="o">.</span><span class="n">angles</span><span class="o">.</span><span class="n">AngularSeparation</span><span class="p">(</span><span class="n">ra1</span><span class="p">,</span> <span class="n">dec1</span><span class="p">,</span> <span class="n">ra2</span><span class="p">,</span> <span class="n">dec2</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">decimal</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s">&#39;degree&#39;</span><span class="p">))</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">arcsec</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
  <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="sameName"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.sameName">[docs]</a><span class="k">def</span> <span class="nf">sameName</span><span class="p">(</span><span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">chars</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Boolean: Given names of two objects, checks that they have a certain number of name characters in common </span>
<span class="sd">  Note: discounts &#39;2&#39; in object names with &#39;2MASS&#39; or &#39;2m&#39;</span>

<span class="sd">  *chars*</span>
<span class="sd">   Number of consecutive characters to match, 4 by default. (e.g &#39;2m0355&#39; and &#39;2MASSJ0355+1234&#39; have &#39;0355&#39; in common with chars=4)</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">import</span> <span class="nn">re</span>
  <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;2MASS&#39;</span><span class="p">,</span> <span class="s">&#39;2mass&#39;</span><span class="p">,</span> <span class="s">&#39;2M&#39;</span><span class="p">,</span> <span class="s">&#39;2m&#39;</span><span class="p">]:</span>
      <span class="k">try</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="k">pass</span>
    <span class="k">return</span> <span class="n">name</span>

  <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;\D&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">clean</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name1</span><span class="p">))),</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;\D&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">clean</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name2</span><span class="p">)))</span>  
  <span class="k">return</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;\D&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">clean</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name1</span><span class="p">)))[:</span><span class="n">chars</span><span class="p">]</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;\D&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">clean</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name2</span><span class="p">)))[:</span><span class="n">chars</span><span class="p">]</span> <span class="k">else</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="scrub"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.scrub">[docs]</a><span class="k">def</span> <span class="nf">scrub</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  For input data [w,f,e] or [w,f] returns the list with NaN, negative, and zero flux (and corresponsing wavelengths and errors) removed. </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">unit</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;unit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
  <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;unit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)]</span>
  <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
  <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])))]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
  <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">return_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]])]</span><span class="o">*</span><span class="n">Q</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">Q</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">units</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="smooth"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.smooth">[docs]</a><span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">beta</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Smooths a spectrum *x* using a Kaiser-Bessel smoothing window of narrowness *beta* (~1 =&gt; very smooth, ~100 =&gt; not smooth) </span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">window_len</span> <span class="o">=</span> <span class="mi">11</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">window_len</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="n">window_len</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
  <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kaiser</span><span class="p">(</span><span class="n">window_len</span><span class="p">,</span><span class="n">beta</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="n">w</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">s</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;valid&#39;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">y</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">unit</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;unit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="specType"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.specType">[docs]</a><span class="k">def</span> <span class="nf">specType</span><span class="p">(</span><span class="n">SpT</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  (By Joe Filippazzo)</span>

<span class="sd">  Converts between float and letter/number M, L, T and Y spectral types (e.g. 14.5 =&gt; &#39;L4.5&#39; and &#39;T3&#39; =&gt; 23).</span>

<span class="sd">  *SpT*</span>
<span class="sd">    Float spectral type between 0.0 and 39.9 or letter/number spectral type between M0.0 and Y9.9</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">SpT</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">SpT</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;M&#39;</span><span class="p">,</span><span class="s">&#39;L&#39;</span><span class="p">,</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="s">&#39;Y&#39;</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">SpT</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s">&#39;M&#39;</span><span class="p">,</span><span class="s">&#39;L&#39;</span><span class="p">,</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="s">&#39;Y&#39;</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">])</span> <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="n">SpT</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">print</span> <span class="s">&quot;Spectral type must be a float between 0 and 40 or a string of class M, L, T or Y.&quot;</span><span class="p">;</span> <span class="k">return</span> <span class="n">SpT</span>
  <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">SpT</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">SpT</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">SpT</span> <span class="o">&lt;</span> <span class="mf">40.0</span><span class="p">:</span> 
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#39;{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;MLTY&#39;</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SpT</span><span class="o">//</span><span class="mi">10</span><span class="p">)],</span> <span class="nb">int</span><span class="p">(</span><span class="n">SpT</span><span class="o">%</span><span class="mi">10</span><span class="p">)</span> <span class="k">if</span> <span class="n">SpT</span><span class="o">%</span><span class="mi">10</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">SpT</span><span class="o">%</span><span class="mi">10</span><span class="p">)</span> <span class="k">else</span> <span class="n">SpT</span><span class="o">%</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">print</span> <span class="s">&quot;Spectral type must be a float between 0 and 40 or a string of class M, L, T or Y.&quot;</span><span class="p">;</span> <span class="k">return</span> <span class="n">SpT</span>
  <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">SpT</span>
  </div>
<div class="viewcode-block" id="str2Q"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.str2Q">[docs]</a><span class="k">def</span> <span class="nf">str2Q</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Given a string of units unconnected to a number, returns the units as a quantity to be multiplied with the number. </span>
<span class="sd">  Inverse units must be represented by a forward-slash prefix or negative power suffix, e.g. inverse square seconds may be &quot;/s2&quot; or &quot;s-2&quot; </span>

<span class="sd">  *x*</span>
<span class="sd">    The units as a string, e.g. str2Q(&#39;W/m2/um&#39;) =&gt; np.array(1.0) * W/(m**2*um)</span>
<span class="sd">  *target*</span>
<span class="sd">    The target units as a string if rescaling is necessary, e.g. str2Q(&#39;Wm-2um-1&#39;,target=&#39;erg/s/cm2/cm&#39;) =&gt; np.array(10000000.0) * erg/(cm**3*s)</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">if</span> <span class="n">x</span><span class="p">:</span>       
    <span class="k">def</span> <span class="nf">Q</span><span class="p">(</span><span class="n">IN</span><span class="p">):</span>
      <span class="n">OUT</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Jy&#39;</span><span class="p">,</span> <span class="s">&#39;erg&#39;</span><span class="p">,</span> <span class="s">&#39;/s&#39;</span><span class="p">,</span> <span class="s">&#39;s-1&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="s">&#39;/um&#39;</span><span class="p">,</span> <span class="s">&#39;um-1&#39;</span><span class="p">,</span> <span class="s">&#39;um&#39;</span><span class="p">,</span> <span class="s">&#39;/cm2&#39;</span><span class="p">,</span> <span class="s">&#39;cm-2&#39;</span><span class="p">,</span> <span class="s">&#39;cm2&#39;</span><span class="p">,</span> <span class="s">&#39;/cm&#39;</span><span class="p">,</span> <span class="s">&#39;cm-1&#39;</span><span class="p">,</span> <span class="s">&#39;cm&#39;</span><span class="p">,</span> <span class="s">&#39;/A&#39;</span><span class="p">,</span> <span class="s">&#39;A-1&#39;</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;W&#39;</span><span class="p">,</span> <span class="s">&#39;/m2&#39;</span><span class="p">,</span> <span class="s">&#39;m-2&#39;</span><span class="p">,</span> <span class="s">&#39;m2&#39;</span><span class="p">,</span> <span class="s">&#39;/m&#39;</span><span class="p">,</span> <span class="s">&#39;m-1&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;/Hz&#39;</span><span class="p">,</span> <span class="s">&#39;Hz-1&#39;</span><span class="p">]</span>
      <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">Jy</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">erg</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">um</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">um</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**-</span><span class="mi">2</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**-</span><span class="mi">2</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">m</span><span class="o">**-</span><span class="mi">2</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">m</span><span class="o">**-</span><span class="mi">2</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">m</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">m</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">Hz</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">Hz</span><span class="o">**-</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="n">vals</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">IN</span><span class="p">:</span>
          <span class="n">OUT</span> <span class="o">=</span> <span class="n">OUT</span><span class="o">*</span><span class="n">v</span>
          <span class="n">IN</span> <span class="o">=</span> <span class="n">IN</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">OUT</span>

    <span class="n">unit</span> <span class="o">=</span> <span class="n">Q</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span><span class="p">:</span>
      <span class="n">z</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">target</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;{} could not be rescaled to {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">unit</span> 
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">q</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
      </div>
<div class="viewcode-block" id="squaredError"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.squaredError">[docs]</a><span class="k">def</span> <span class="nf">squaredError</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Computes the squared error of two arrays. Pass to scipy.optimize.fmin() to find least square or use scipy.optimize.leastsq()</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">a</span> <span class="o">-=</span> <span class="n">b</span>
  <span class="n">a</span> <span class="o">*=</span> <span class="n">a</span> 
  <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">else</span> <span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span>
  <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="sxg2deg"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.sxg2deg">[docs]</a><span class="k">def</span> <span class="nf">sxg2deg</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
  <span class="n">RA</span><span class="p">,</span> <span class="n">DEC</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
  <span class="k">if</span> <span class="n">ra</span><span class="p">:</span> <span class="n">RA</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">apc</span><span class="o">.</span><span class="n">angles</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;hour&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">decimal</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">dec</span><span class="p">:</span> <span class="n">DEC</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">apc</span><span class="o">.</span><span class="n">angles</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;degree&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">decimal</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">RA</span><span class="p">,</span> <span class="n">DEC</span><span class="p">)</span> <span class="k">if</span> <span class="n">ra</span> <span class="ow">and</span> <span class="n">dec</span> <span class="k">else</span> <span class="n">RA</span> <span class="ow">or</span> <span class="n">DEC</span>
</div>
<div class="viewcode-block" id="tails"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.tails">[docs]</a><span class="k">def</span> <span class="nf">tails</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Appends the Wein and Rayleigh-Jeans tails of the *model* to the given *spectrum*</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">final</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[[</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">start</span><span class="p">],</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">end</span><span class="p">]],</span> <span class="p">[</span><span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">start</span><span class="p">],</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">end</span><span class="p">]],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)),</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">end</span><span class="p">))]]]</span>  
  <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="o">*</span><span class="n">spectrum</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="o">*</span><span class="n">final</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">final</span>

<span class="c"># def trim_spectrum(spectrum, regions, smooth_edges=10):</span>
<span class="c">#   units, spectrum = [i.unit if hasattr(i,&#39;unit&#39;) else 1 for i in spectrum], [i.value if hasattr(i,&#39;unit&#39;) else i for i in spectrum]</span>
<span class="c">#   trimmed_spec = [i[idx_exclude(spectrum[0], regions)] for i in spectrum]</span>
<span class="c">#   if smooth_edges: </span>
<span class="c">#     for r in regions: </span>
<span class="c">#       if any(spectrum[0][spectrum[0]&gt;r[1]]): trimmed_spec = inject_average(trimmed_spec, r[1], &#39;right&#39;, n=smooth_edges)</span>
<span class="c">#       if any(spectrum[0][spectrum[0]&lt;r[0]]): trimmed_spec = inject_average(trimmed_spec, r[0], &#39;left&#39;, n=smooth_edges)</span>
<span class="c">#   return [np.array(i)*j for i,j in zip(units,trimmed_spec)]</span>
</div>
<div class="viewcode-block" id="trim_spectrum"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.trim_spectrum">[docs]</a><span class="k">def</span> <span class="nf">trim_spectrum</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">regions</span><span class="p">,</span> <span class="n">smooth_edges</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="n">trimmed_spec</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">idx_exclude</span><span class="p">(</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">regions</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spectrum</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">smooth_edges</span><span class="p">:</span> 
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]]):</span> <span class="n">trimmed_spec</span> <span class="o">=</span> <span class="n">inject_average</span><span class="p">(</span><span class="n">trimmed_spec</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">smooth_edges</span><span class="p">)</span>
      <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
      <span class="k">try</span><span class="p">:</span> 
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]]):</span> <span class="n">trimmed_spec</span> <span class="o">=</span> <span class="n">inject_average</span><span class="p">(</span><span class="n">trimmed_spec</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">smooth_edges</span><span class="p">)</span>
      <span class="k">except</span><span class="p">:</span> <span class="k">pass</span> 
  <span class="k">return</span> <span class="n">trimmed_spec</span>
</div>
<div class="viewcode-block" id="txt2dict"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.txt2dict">[docs]</a><span class="k">def</span> <span class="nf">txt2dict</span><span class="p">(</span><span class="n">txtfile</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="p">[],</span> <span class="n">ignore</span><span class="o">=</span><span class="p">[],</span> <span class="n">to_list</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">all_str</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">obj_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">key_row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  For given *txtfile* returns a parent dictionary with keys from *obj_col* and child dictionaries with keys from *key_row*, delimited by *delim* character.</span>
<span class="sd">  Characters to *ignore*, entire lines to *skip*, and the data row to *start* at can all be specified.</span>
<span class="sd">  Floats and integers are returned as numbers unless *all_str* is set True.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">replace_all</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">dic</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
    
  <span class="n">txt</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">txtfile</span><span class="p">)</span>
  <span class="n">d</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,[[</span><span class="n">j</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">replace_all</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ignore</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delim</span> <span class="ow">or</span> <span class="bp">None</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">txt</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">])])[</span><span class="n">start</span><span class="p">:]</span>
  <span class="n">txt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">obj_col</span><span class="p">))</span>
  <span class="n">keys</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">key_row</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>

  <span class="k">if</span> <span class="n">all_str</span><span class="p">:</span> <span class="k">return</span> <span class="n">d</span> <span class="k">if</span> <span class="n">to_list</span> <span class="k">else</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]:{</span><span class="n">k</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:])}</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">d</span><span class="p">}</span>
  <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">d</span> <span class="k">if</span> <span class="n">to_list</span> <span class="k">else</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]:{</span><span class="n">k</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="s">&#39;-&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="nb">unicode</span><span class="p">)</span> <span class="k">else</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">v</span><span class="o">==</span><span class="s">&#39;True&#39;</span> <span class="k">else</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">v</span><span class="o">==</span><span class="s">&#39;False&#39;</span> <span class="k">else</span> <span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:])}</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">d</span><span class="p">}</span>
</div>
<div class="viewcode-block" id="try_except"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.try_except">[docs]</a><span class="k">def</span> <span class="nf">try_except</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">failure</span><span class="p">,</span> <span class="n">exceptions</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Replaces the multi-line try/except statement with a function</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">success</span><span class="p">()</span> <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">success</span><span class="p">)</span> <span class="k">else</span> <span class="n">success</span>
  <span class="k">except</span> <span class="n">exceptions</span> <span class="ow">or</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">failure</span><span class="p">()</span> <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">failure</span><span class="p">)</span> <span class="k">else</span> <span class="n">failure</span>      
</div>
<div class="viewcode-block" id="unc"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.unc">[docs]</a><span class="k">def</span> <span class="nf">unc</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">SNR</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Removes NaNs negatives and zeroes from *spectrum* arrays of form [W,F] or [W,F,E].</span>
<span class="sd">  Generates E at signal to noise *SNR* for [W,F] and replaces NaNs with the same for [W,F,E]. </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">S</span> <span class="o">=</span> <span class="n">scrub</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span> <span class="n">S</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">/</span><span class="n">SNR</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">else</span> <span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">S</span><span class="p">[</span><span class="mi">2</span><span class="p">])],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float32&#39;</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;unit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">S</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">SNR</span><span class="p">)</span>
  <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> <span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">SNR</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">S</span>
</div>
<div class="viewcode-block" id="xl2dict"><a class="viewcode-back" href="../../BDNYCdb.html#BDNYCdb.utilities.xl2dict">[docs]</a><span class="k">def</span> <span class="nf">xl2dict</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">sheet</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">obj_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">key_row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">manual_keys</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
  <span class="n">workbook</span> <span class="o">=</span> <span class="n">xlrd</span><span class="o">.</span><span class="n">open_workbook</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
  <span class="n">column_names</span> <span class="o">=</span> <span class="n">manual_keys</span> <span class="ow">or</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">workbook</span><span class="o">.</span><span class="n">sheet_by_index</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span><span class="o">.</span><span class="n">row_values</span><span class="p">(</span><span class="n">key_row</span><span class="p">)]</span>
  <span class="n">objects</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="n">sheet_by_index</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span><span class="o">.</span><span class="n">col_values</span><span class="p">(</span><span class="n">obj_col</span><span class="p">)[</span><span class="n">start</span><span class="p">:]</span>
  <span class="k">if</span> <span class="n">manual_keys</span><span class="p">:</span> <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">workbook</span><span class="o">.</span><span class="n">sheet_by_index</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span><span class="o">.</span><span class="n">col_values</span><span class="p">(</span><span class="n">n</span><span class="p">)[</span><span class="n">start</span><span class="p">:]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">manual_keys</span><span class="p">))]</span>
  <span class="k">else</span><span class="p">:</span> <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">workbook</span><span class="o">.</span><span class="n">sheet_by_index</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span><span class="o">.</span><span class="n">col_values</span><span class="p">(</span><span class="n">c</span><span class="p">)[</span><span class="n">start</span><span class="p">:]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="n">column_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]]</span>
  <span class="k">return</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">cn</span><span class="p">):</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">))</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">unicode</span><span class="p">)</span> <span class="k">else</span> <span class="n">val</span> <span class="k">for</span> <span class="n">cn</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span><span class="n">value</span><span class="p">)}</span> <span class="k">for</span> <span class="n">obj</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">))}</span>
 </div>
<span class="k">def</span> <span class="nf">__create_waxis</span><span class="p">(</span><span class="n">fitsHeader</span><span class="p">,</span> <span class="n">lenData</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wlog</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="c"># Define key names in</span>
    <span class="n">KEY_MIN</span>  <span class="o">=</span> <span class="p">[</span><span class="s">&#39;COEFF0&#39;</span><span class="p">,</span><span class="s">&#39;CRVAL1&#39;</span><span class="p">]</span>         <span class="c"># Min wl</span>
    <span class="n">KEY_DELT</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;COEFF1&#39;</span><span class="p">,</span><span class="s">&#39;CDELT1&#39;</span><span class="p">,</span><span class="s">&#39;CD1_1&#39;</span><span class="p">]</span> <span class="c"># Delta of wl</span>
    <span class="n">KEY_OFF</span>  <span class="o">=</span> <span class="p">[</span><span class="s">&#39;LTV1&#39;</span><span class="p">]</span>                    <span class="c"># Offset in wl to subsection start</span>
    
    <span class="c"># Find key names for minimum wl, delta, and wl offset in fits header</span>
    <span class="n">setMin</span>  <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">KEY_MIN</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fitsHeader</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">setDelt</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">KEY_DELT</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fitsHeader</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">setOff</span>  <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">KEY_OFF</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fitsHeader</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    
    <span class="c"># Get the values for minimum wl, delta, and wl offset, and generate axis</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">setMin</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span> <span class="p">(</span><span class="n">setDelt</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">nameMin</span> <span class="o">=</span> <span class="n">setMin</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">valMin</span>  <span class="o">=</span> <span class="n">fitsHeader</span><span class="p">[</span><span class="n">nameMin</span><span class="p">]</span>
        
        <span class="n">nameDelt</span> <span class="o">=</span> <span class="n">setDelt</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">valDelt</span>  <span class="o">=</span> <span class="n">fitsHeader</span><span class="p">[</span><span class="n">nameDelt</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">setOff</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">valOff</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nameOff</span> <span class="o">=</span> <span class="n">setOff</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">valOff</span>  <span class="o">=</span> <span class="n">fitsHeader</span><span class="p">[</span><span class="n">nameOff</span><span class="p">]</span>
        
        <span class="c"># generate wl axis</span>
        <span class="k">if</span> <span class="n">nameMin</span> <span class="o">==</span> <span class="s">&#39;COEFF0&#39;</span> <span class="ow">or</span> <span class="n">wlog</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="c"># SDSS fits files</span>
            <span class="n">wAxis</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lenData</span><span class="p">)</span> <span class="o">*</span> <span class="n">valDelt</span> <span class="o">+</span> <span class="n">valMin</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wAxis</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lenData</span><span class="p">)</span> <span class="o">*</span> <span class="n">valDelt</span><span class="p">)</span> <span class="o">+</span> <span class="n">valMin</span> <span class="o">-</span> <span class="p">(</span><span class="n">valOff</span> <span class="o">*</span> <span class="n">valDelt</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wAxis</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Could not re-create wavelength axis for &#39;</span> <span class="o">+</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span>
    
    <span class="k">return</span> <span class="n">wAxis</span>

<span class="k">def</span> <span class="nf">__get_spec</span><span class="p">(</span><span class="n">fitsData</span><span class="p">,</span> <span class="n">fitsHeader</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">errorVals</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">errorVals</span><span class="p">:</span>
        <span class="n">validData</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">validData</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
    
    <span class="c"># Identify number of data sets in fits file</span>
    <span class="n">dimNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitsData</span><span class="p">)</span>
    
    <span class="c"># Identify data sets in fits file</span>
    <span class="n">fluxIdx</span>  <span class="o">=</span> <span class="bp">None</span>
    <span class="n">waveIdx</span>  <span class="o">=</span> <span class="bp">None</span>
    <span class="n">sigmaIdx</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">if</span> <span class="n">dimNum</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">fluxIdx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">dimNum</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitsData</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">sampleData</span> <span class="o">=</span> <span class="n">fitsData</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">20</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sampleData</span> <span class="o">=</span> <span class="n">fitsData</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">20</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sampleData</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
            <span class="c"># 0-flux, 1-unknown</span>
            <span class="n">fluxIdx</span>  <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">waveIdx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">fluxIdx</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">dimNum</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">waveIdx</span>  <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fluxIdx</span>  <span class="o">=</span> <span class="mi">1</span>
        <span class="n">sigmaIdx</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">dimNum</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
    <span class="c"># 0-flux clean, 1-flux raw, 2-background, 3-sigma clean</span>
        <span class="n">fluxIdx</span>  <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sigmaIdx</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">dimNum</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
    <span class="c"># 0-flux, 1-continuum substracted flux, 2-sigma, 3-mask array, 4-unknown</span>
        <span class="n">fluxIdx</span>  <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sigmaIdx</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">dimNum</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="c"># Implies that only one data set in fits file: flux</span>
        <span class="n">fluxIdx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">fitsData</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">fluxIdx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitsData</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c"># Data comes in a xxxx by 2 matrix (ascii origin)</span>
            <span class="n">tmpWave</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tmpFlux</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">fitsData</span><span class="p">:</span>
                <span class="n">tmpWave</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">tmpFlux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">fitsData</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmpWave</span><span class="p">,</span><span class="n">tmpFlux</span><span class="p">]</span>
            <span class="n">fitsData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fitsData</span><span class="p">)</span>
            
            <span class="n">waveIdx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">fluxIdx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
        <span class="c"># Indicates that data is structured in an unrecognized way</span>
            <span class="n">fluxIdx</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fluxIdx</span> <span class="o">=</span> <span class="bp">None</span>
        
    <span class="c"># Fetch wave data set from fits file</span>
    <span class="k">if</span> <span class="n">fluxIdx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="c"># No interpretation known for fits file data sets</span>
        <span class="n">validData</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Unable to interpret data in &#39;</span> <span class="o">+</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span>
        <span class="k">return</span> <span class="n">validData</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">waveIdx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitsData</span><span class="p">[</span><span class="n">waveIdx</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># Data set may be a 1-item list</span>
                <span class="n">validData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitsData</span><span class="p">[</span><span class="n">waveIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">validData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitsData</span><span class="p">[</span><span class="n">waveIdx</span><span class="p">]</span>
    
    <span class="c"># Fetch flux data set from fits file</span>
    <span class="k">if</span> <span class="n">fluxIdx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">validData</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitsData</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitsData</span><span class="p">[</span><span class="n">fluxIdx</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">validData</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitsData</span><span class="p">[</span><span class="n">fluxIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">validData</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitsData</span><span class="p">[</span><span class="n">fluxIdx</span><span class="p">]</span>
    
    <span class="c"># Fetch sigma data set from fits file, if requested</span>
    <span class="k">if</span> <span class="n">errorVals</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sigmaIdx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">validData</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">validData</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitsData</span><span class="p">[</span><span class="n">sigmaIdx</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">validData</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitsData</span><span class="p">[</span><span class="n">sigmaIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">validData</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitsData</span><span class="p">[</span><span class="n">sigmaIdx</span><span class="p">]</span>
        
        <span class="c"># If all sigma values have the same value, replace them with nans</span>
        <span class="k">if</span> <span class="n">validData</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="n">validData</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">==</span> <span class="n">validData</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">12</span><span class="p">]:</span>
            <span class="n">validData</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">validData</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    
    <span class="k">return</span> <span class="n">validData</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Joe Filippazzo.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>